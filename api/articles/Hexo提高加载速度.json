{"title":"Hexo提高加载速度","uid":"a2a2c6e710e3fc9812c7982541e8d115","slug":"Hexo提高加载速度","date":"2019-05-01T18:46:17.000Z","updated":"2021-06-17T09:25:06.579Z","comments":true,"path":"api/articles/Hexo提高加载速度.json","cover":"https://guanqr.com/images/speed-up-hexo.png","content":"<p>Hexo作为纯静态博客最大的优点就是快，但要真正的快起来你可能需要做这些事情。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"托管平台（可选）\"><a href=\"#托管平台（可选）\" class=\"headerlink\" title=\"托管平台（可选）\"></a>托管平台（可选）</h2><p>直接在<a href=\"https://coding.net/\">Coding</a>等国内平台托管<code>Page</code>项目，修改国内线路解析。(可参照<a href=\"https://cloudycity.me/p/c283.html#%E5%88%86%E7%BA%BF%E8%B7%AF%E8%A7%A3%E6%9E%90\">Github Hexo的百度收录问题</a>)<br>Coding绑定了域名需定期申请SSL证书，所以本博放弃此项。</p>\n<h2 id=\"CDN加速\"><a href=\"#CDN加速\" class=\"headerlink\" title=\"CDN加速\"></a>CDN加速</h2><p>这里只是针对第三方静态文件的加速，修改<code>Next</code>主题配置文件<code>_config.yml</code>如下：</p>\n<details class=\"custom-details\">\n<summary>Click to see more</summary>\n<p><pre class=\"line-numbers language-none\"><code class=\"language-none\">vendors:\n  # Internal path prefix. Please do not edit it.\n  _internal: lib\n\n  # Internal version: 2.1.3\n  jquery: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery&#x2F;2.1.3&#x2F;jquery.min.js\n\n  # Internal version: 2.1.5\n  # See: http:&#x2F;&#x2F;fancyapps.com&#x2F;fancybox&#x2F;\n  fancybox: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;fancybox&#x2F;2.1.5&#x2F;jquery.fancybox.min.js # https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;fancybox&#x2F;2.1.5&#x2F;jquery.fancybox.pack.js\n  fancybox_css: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;fancybox&#x2F;2.1.5&#x2F;jquery.fancybox.min.css\n\n  # Internal version: 1.0.6\n  # See: https:&#x2F;&#x2F;github.com&#x2F;ftlabs&#x2F;fastclick\n  fastclick: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;fastclick&#x2F;1.0.6&#x2F;fastclick.min.js\n\n  # Internal version: 1.9.7\n  # See: https:&#x2F;&#x2F;github.com&#x2F;tuupola&#x2F;jquery_lazyload\n  lazyload: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery_lazyload&#x2F;1.9.7&#x2F;jquery.lazyload.min.js\n\n  # Internal version: 1.2.1\n  # See: http:&#x2F;&#x2F;VelocityJS.org\n  velocity: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;velocity&#x2F;1.2.1&#x2F;velocity.min.js\n\n  # Internal version: 1.2.1\n  # See: http:&#x2F;&#x2F;VelocityJS.org\n  velocity_ui: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;velocity&#x2F;1.2.1&#x2F;velocity.ui.min.js\n\n  # Internal version: 0.7.9\n  # See: https:&#x2F;&#x2F;faisalman.github.io&#x2F;ua-parser-js&#x2F;\n  ua_parser:\n\n  # Internal version: 4.6.2\n  # See: http:&#x2F;&#x2F;fontawesome.io&#x2F;\n  fontawesome: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;font-awesome&#x2F;4.6.2&#x2F;css&#x2F;font-awesome.min.css\n\n  # Internal version: 1\n  # https:&#x2F;&#x2F;www.algolia.com\n  algolia_instant_js:\n  algolia_instant_css:\n\n  # Internal version: 1.0.2\n  # See: https:&#x2F;&#x2F;github.com&#x2F;HubSpot&#x2F;pace\n  # Or use direct links below:\n  # pace: &#x2F;&#x2F;cdn.bootcss.com&#x2F;pace&#x2F;1.0.2&#x2F;pace.min.js\n  # pace_css: &#x2F;&#x2F;cdn.bootcss.com&#x2F;pace&#x2F;1.0.2&#x2F;themes&#x2F;blue&#x2F;pace-theme-flash.min.css\n  pace: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;pace&#x2F;1.0.2&#x2F;pace.min.js\n  pace_css: https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;pace&#x2F;1.0.2&#x2F;themes&#x2F;blue&#x2F;pace-theme-flash.min.css<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">注意</p>\n<p>针对自定义的静态文件(main.min.js和main.min.css)需要自行使用融合CDN，国内都需要备案域名，本博的<code>.me</code>域名没有备案资质，但我不太想将静态文件放到其他域名，所以放弃加速这类文件。</p>\n</div>\n<h2 id=\"压缩文件\"><a href=\"#压缩文件\" class=\"headerlink\" title=\"压缩文件\"></a>压缩文件</h2><h3 id=\"hexo-neat\"><a href=\"#hexo-neat\" class=\"headerlink\" title=\"hexo-neat\"></a>hexo-neat</h3><h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-neat --save<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h4><p>修改项目<code>_config.yml</code>。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">neat_enable: true\nneat_html:\n  enable: true\n  exclude:\nneat_css:\n  enable: false\n  exclude:\n    - &#39;**&#x2F;*.min.css&#39;\nneat_js:\n  enable: false\n  mangle: true\n  output:\n  compress:\n  exclude:\n    - &#39;**&#x2F;*.min.js&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">后面会使用<code>gulp</code>合并与压缩js与css，所以此处只用<code>neat</code>压缩了html。如果你不想使用合并js与css，此处可以打开<code>neat_js</code>、<code>neat_css</code>。</p>\n<p>:::</p>\n<h3 id=\"gulp\"><a href=\"#gulp\" class=\"headerlink\" title=\"gulp\"></a>gulp</h3><p><code>gulp</code>是自动化构建工具，这里主要是用来合并、压缩js与css。</p>\n<h4 id=\"构建配置\"><a href=\"#构建配置\" class=\"headerlink\" title=\"构建配置\"></a>构建配置</h4><p><code>Next</code>主题目录自带了<code>gulpfile.coffee</code>，这里直接修改：</p>\n<p>:::details Click to see more</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">fs &#x3D; require(&#39;fs&#39;)\npath &#x3D; require(&#39;path&#39;)\ngulp &#x3D; require(&#39;gulp&#39;)\njshint &#x3D; require(&#39;gulp-jshint&#39;) # js语法检查\njslish &#x3D; require(&#39;jshint-stylish&#39;) # js语法检查输出美化\nstylint &#x3D; require(&#39;gulp-stylint&#39;) # stylus语法检查\nstylish &#x3D; require(&#39;stylint-stylish&#39;) # stylus语法检查输出美化\nyaml &#x3D; require(&#39;js-yaml&#39;)\nconcat &#x3D; require(&#39;gulp-concat&#39;) # js合并\nuglify &#x3D; require(&quot;gulp-uglify&quot;) # js压缩\nconcatCss &#x3D; require(&#39;gulp-concat-css&#39;) # css合并\ncleanCss &#x3D; require(&#39;gulp-clean-css&#39;) # css压缩\n\n# js语法检查 https:&#x2F;&#x2F;jshint.com&#x2F;docs&#x2F;options&#x2F;\ngulp.task &#39;lint:js&#39;, -&gt;\n  return gulp.src path.join(__dirname, &#39;.&#x2F;source&#x2F;js&#x2F;**&#x2F;*.js&#39;)\n    .pipe jshint()\n    .pipe jshint.reporter()\n\n# stylus语法检查 https:&#x2F;&#x2F;github.com&#x2F;SimenB&#x2F;stylint\ngulp.task &#39;lint:stylus&#39;, -&gt;\n  return gulp.src path.join(__dirname, &#39;&#x2F;source&#x2F;css&#x2F;**&#x2F;*.styl&#39;)\n    .pipe stylint(&#123;config: path.join(__dirname, &#39;.stylintrc&#39;)&#125;)\n    .pipe stylint.reporter(stylish)\n\n# 配置文件检验\ngulp.task &#39;validate:config&#39;, (cb) -&gt;\n  themeConfig &#x3D; fs.readFileSync path.join(__dirname, &#39;_config.yml&#39;)\n  try\n    yaml.safeLoad(themeConfig)\n    cb()\n  catch error\n    cb new Error(error)\n\n# 语言文件检验\ngulp.task &#39;validate:languages&#39;, (cb) -&gt;\n  languagesPath &#x3D; path.join __dirname, &#39;languages&#39;\n  languages &#x3D; fs.readdirSync languagesPath\n  errors &#x3D; []\n\n  for lang in languages\n    languagePath &#x3D; path.join languagesPath, lang\n    try\n      yaml.safeLoad fs.readFileSync(languagePath), &#123;\n        filename: path.relative(__dirname, languagePath)\n      &#125;\n    catch error\n      errors.push error\n\n  if errors.length &#x3D;&#x3D; 0\n    cb()\n  else\n    cb(errors)\n\n# 合并压缩js\n# gulp.task &#39;minify:js&#39;, [&#39;lint:js&#39;], (cb) -&gt;\ngulp.task &#39;minify:js&#39;, (cb) -&gt;\n  return gulp.src([\n    path.join(__dirname, &#39;source&#x2F;js&#x2F;src&#x2F;utils.js&#39;),\n    path.join(__dirname, &#39;source&#x2F;js&#x2F;src&#x2F;motion.js&#39;),\n    path.join(__dirname, &#39;source&#x2F;js&#x2F;src&#x2F;gitment.browser.js&#39;),\n    path.join(__dirname, &#39;source&#x2F;js&#x2F;src&#x2F;bootstrap.js&#39;),\n    path.join(__dirname, &#39;source&#x2F;js&#x2F;src&#x2F;scrollspy.js&#39;),\n    path.join(__dirname, &#39;source&#x2F;js&#x2F;src&#x2F;post-details.js&#39;),\n  ]).pipe concat(&#39;main.min.js&#39;)\n    .pipe uglify()\n    .pipe gulp.dest path.join __dirname, &#39;..&#x2F;..&#x2F;public&#x2F;js&#39;\n\n# 合并压缩js\n# gulp.task &#39;minify:css&#39;, [&#39;lint:stylus&#39;], (cb) -&gt;\ngulp.task &#39;minify:css&#39;, (cb) -&gt;\n  return gulp.src([\n    path.join(__dirname, &#39;..&#x2F;..&#x2F;public&#x2F;css&#x2F;main.css&#39;),\n    path.join(__dirname, &#39;source&#x2F;css&#x2F;src&#x2F;gitment.css&#39;),\n  ]).pipe concat(&#39;main.min.css&#39;)\n    .pipe cleanCss()\n    .pipe gulp.dest path.join __dirname, &#39;..&#x2F;..&#x2F;public&#x2F;css&#39;\n\n# 执行\ngulp.task &#39;default&#39;, [\n  &#39;validate:config&#39;,\n  &#39;validate:languages&#39;\n  &#39;minify:js&#39;,\n  &#39;minify:css&#39;,\n]<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</div>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">提示</p>\n<p><code>Next</code>主题默认的<code>gulpfile.coffee</code>只是进行规范检查，不过此处修改后默认关闭，按需开启。</p>\n</div>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">注意</p>\n<p>合并js时尽量保持模板中引入的顺序，避免不必要错误。</p>\n</div>\n<p>在项目根目录下新建<code>gulpfile.js</code>：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">require(&#39;coffeescript&#x2F;register&#39;)\nrequire(&#39;.&#x2F;themes&#x2F;next&#x2F;gulpfile.coffee&#39;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"安装相关依赖\"><a href=\"#安装相关依赖\" class=\"headerlink\" title=\"安装相关依赖\"></a>安装相关依赖</h4><p>安装构建任务用到的依赖。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">npm install gulp -g\nnpm install coffeescript --save-dev # 用于在gulpfile.js中引入gulpfile.coffee\nnpm install gulp-clean-css --save-dev # css压缩\nnpm install gulp-concat --save-dev # js合并\nnpm install gulp-concat-css --save-dev # css合并\nnpm install gulp-jshint --save-dev # js语法检查\nnpm install gulp-stylint --save-dev # css语法检查\nnpm install gulp-uglify --save-dev # js压缩\nnpm install jshint --save-dev # js压缩核心\nnpm install jshint-stylish --save-dev # js语法检查输出美化\nnpm install stylint-stylish --save-dev # css语法检查输出美化<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"执行构建\"><a href=\"#执行构建\" class=\"headerlink\" title=\"执行构建\"></a>执行构建</h4><p>项目根目录执行<code>gulp</code>：</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/57032007-d1507900-6c7b-11e9-8c4f-22be1b05c910.png\" alt=\"image\"></p>\n<p>构建输出合并与压缩后的文件：</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/57032110-23919a00-6c7c-11e9-8999-a24577e5296e.png\" alt=\"image\"></p>\n<h4 id=\"更新模板\"><a href=\"#更新模板\" class=\"headerlink\" title=\"更新模板\"></a>更新模板</h4><p>修改<code>themes/next/layout/_partials/head.swig</code>:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;link href&#x3D;&quot;&#123;&#123; font_awesome_uri &#125;&#125;&quot; rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; &#x2F;&gt;\n\n\n &lt;link href&#x3D;&quot;&#123;&#123; url_for(theme.css) &#125;&#125;&#x2F;main.css?v&#x3D;&#123;&#123; theme.version &#125;&#125;&quot; rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; &#x2F;&gt;\t&lt;link href&#x3D;&quot;&#123;&#123; url_for(theme.css) &#125;&#125;&#x2F;main.min.css?v&#x3D;&#123;&#123; theme.version &#125;&#125;&quot; rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; &#x2F;&gt;\n\n\n &#123;% if theme.favicon.apple_touch_icon %&#125;\t&#123;% if theme.favicon.apple_touch_icon %&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>修改<code>themes/next/layout/_layout.swig</code>:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;% include &#39;_scripts&#x2F;vendors.swig&#39; %&#125;\n  &lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;&#123;&#123; url_for(theme.js) &#125;&#125;&#x2F;main.min.js?v&#x3D;&#123;&#123; theme.version &#125;&#125;&quot;&gt;&lt;&#x2F;script&gt;\n  &#123;% include &#39;_scripts&#x2F;commons.swig&#39; %&#125;\t  &#123;% include &#39;_scripts&#x2F;commons.swig&#39; %&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>然后在各模板中将引入合并前静态文件的部分注释掉，这里不详细列出，只放出一个例子：</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/57033148-b92e2900-6c7e-11e9-88f9-c86d8bd93e11.png\" alt=\"image\"></p>\n<p>完成后重新部署：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">hexo g &amp;&amp; gulp &amp;&amp; hexo d<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>引用效果：</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/57033361-52f5d600-6c7f-11e9-8857-167b5a80eccf.png\" alt=\"image\"></p>\n<h2 id=\"图片懒加载\"><a href=\"#图片懒加载\" class=\"headerlink\" title=\"图片懒加载\"></a>图片懒加载</h2><p>可以显著加速文章页。</p>\n<p>安装插件:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">npm install hexo-lazyload-image --save<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改项目配置文件<code>_config.yml</code>:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"># 图片懒加载\nlazyload:\n  enable: true \n  onlypost: false\n  loadingImg: &#x2F;images&#x2F;loading&#x2F;loading.gif #如果不填写图片则使用默认的图片<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"精简功能\"><a href=\"#精简功能\" class=\"headerlink\" title=\"精简功能\"></a>精简功能</h2><p>功能涉及多个请求时会比较明显得拖慢加载速度，例如<code>不蒜子</code>、<code>DaoVice</code>，要考量这些功能是否真(hua)的(er)需(bu)要(shi)。（像我已经关掉了<code>DaoVice</code>，只留着<code>不蒜子</code>计算站点UV）</p>\n<h2 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h2><p>首页</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/57033434-7caefd00-6c7f-11e9-9b23-fb7f0b8b4d5d.png\" alt=\"image\"></p>\n<p>文章页</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/57034951-6f940d00-6c83-11e9-8ae7-836267fff2b4.png\" alt=\"image\"></p>\n<p>剩下的瓶颈主要是<code>Gitment</code>、<code>不蒜子</code>。</p>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">提示</p>\n<p>不同网络环境下的加速效果也会不同，以上效果是我在家中的加速效果。在公司的加速效果就差了很多。</p>\n</div>\n","text":"Hexo作为纯静态博客最大的优点就是快，但要真正的快起来你可能需要做这些事情。 托管平台（可选）直接在Coding等国内平台托管Page项目，修改国内线路解析。(可参照Github Hexo的百度收录问题)Coding绑定了域名需定期申请SSL证书，所以本博放弃此项。 CDN加速...","link":"","photos":[],"count_time":{"symbolsCount":"8.7k","symbolsTime":"8 mins."},"categories":[{"name":"新手村","slug":"新手村","count":7,"path":"api/categories/新手村.json"}],"tags":[{"name":"hexo","slug":"hexo","count":5,"path":"api/tags/hexo.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89\"><span class=\"toc-text\">托管平台（可选）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#CDN%E5%8A%A0%E9%80%9F\"><span class=\"toc-text\">CDN加速</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">压缩文件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#hexo-neat\"><span class=\"toc-text\">hexo-neat</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">安装</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">配置</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#gulp\"><span class=\"toc-text\">gulp</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">构建配置</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">安装相关依赖</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%89%A7%E8%A1%8C%E6%9E%84%E5%BB%BA\"><span class=\"toc-text\">执行构建</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9B%B4%E6%96%B0%E6%A8%A1%E6%9D%BF\"><span class=\"toc-text\">更新模板</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD\"><span class=\"toc-text\">图片懒加载</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%B2%BE%E7%AE%80%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">精简功能</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C\"><span class=\"toc-text\">最终效果</span></a></li></ol>","author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity"}}}},"mapped":true,"prev_post":{"title":"Laravel5.8+Dingo+JWT+Swagger 开发API","uid":"58d4f495b2526d01b8b9004566be2a59","slug":"Laravel5-8-Dingo-JWT-Swagger-开发API","date":"2019-06-03T06:03:45.000Z","updated":"2021-06-17T09:25:06.579Z","comments":true,"path":"api/articles/Laravel5-8-Dingo-JWT-Swagger-开发API.json","cover":"https://i.pinimg.com/originals/bd/c4/7c/bdc47c05192f45e6fe2704b3c52995e7.jpg","text":"在Laravel5.8中使用“Laravel必知必会”的两个轮子dingo/api和tymon/jwt-auth以及文档系统swagger-api/swagger-ui开发一个规范优雅的API。 Dingo安装composer require dingo&#x2F;api 组件包...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[{"name":"laravel","slug":"laravel","count":9,"path":"api/tags/laravel.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity"}}}}},"next_post":{"title":"Github Hexo的百度收录问题","uid":"95de16e3846c90a95f98f3b0e459fb6c","slug":"Github-Hexo的百度收录问题","date":"2019-04-28T09:54:27.000Z","updated":"2021-06-17T09:25:06.579Z","comments":true,"path":"api/articles/Github-Hexo的百度收录问题.json","cover":"https://www.sekkeistudio.com/blog/wp-content/uploads/2019/10/SEO-banner.png","text":"Github屏蔽了百度的爬虫，所以部署在Github Page的Hexo无法被百度收录，如果你绑定了自定义域名的话，这里有几个曲线救国方案。 私有主机将博客部署到自己的机器上。 对象存储将博客上传到对象存储。 国内托管在国内的代码托管平台部署Hexo，这里推荐Coding，流程与...","link":"","photos":[],"count_time":{"symbolsCount":631,"symbolsTime":"1 mins."},"categories":[{"name":"新手村","slug":"新手村","count":7,"path":"api/categories/新手村.json"}],"tags":[{"name":"hexo","slug":"hexo","count":5,"path":"api/tags/hexo.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity"}}}}}}