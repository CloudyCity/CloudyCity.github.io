{"title":"使用Webpack开发JS Sdk","uid":"ff1fb0ae51583213dce3cf60573ca74e","slug":"使用Webpack开发JS-Sdk","date":"2019-07-17T05:55:32.000Z","updated":"2021-06-04T03:18:11.680Z","comments":true,"path":"api/articles/使用Webpack开发JS-Sdk.json","cover":"https://pic1.zhimg.com/v2-76676bf647344f92c34a94e3dcc11d38_720w.jpg?source=172ae18b","content":"<p>最近项目需要开发一个JS Sdk，为了保证可读性与可维护性，决定按模块开发，最后使用webpack打包。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"文件结构\"><a href=\"#文件结构\" class=\"headerlink\" title=\"文件结构\"></a>文件结构</h3><pre class=\"line-numbers language-Shell\" data-language=\"Shell\"><code class=\"language-Shell\">|-- config\n|   |-- webpack.base.js\n|   |-- webpack.development.js\n|   |-- webpack.production.js\n|-- dist\n|   |-- mars_minigame_sdk.js\n|   |-- mars_minigame_sdk.min.js\n|-- node_modules\n|-- package-lock.json\n|-- package.json\n|-- src\n|   |-- index.js      # SDK入口\n|   |-- lib\n|   |   &#96;-- util.js   # 工具函数\n|   |-- sdk           # 各渠道SDK\n|       |-- qq.js \n|       |-- wechat.js\n|-- webpack.config.js<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h3><pre class=\"line-numbers language-Shell\" data-language=\"Shell\"><code class=\"language-Shell\">npm install -g webpack webpack-cli\nnpm install --save-dev webpack webpack-cli webpack-merge uglifyjs-webpack-plugin babel-loader<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h3 id=\"配置webpack\"><a href=\"#配置webpack\" class=\"headerlink\" title=\"配置webpack\"></a>配置webpack</h3><p><code>config\\webpack.base.js</code></p>\n<pre class=\"line-numbers language-JavaScript\" data-language=\"JavaScript\"><code class=\"language-JavaScript\">const path &#x3D; require(&#39;path&#39;)\n\nmodule.exports &#x3D; &#123;\n    entry: &#123;\n        &#39;mars_minigame_sdk&#39;: &#39;@&#x2F;index.js&#39;\n    &#125;,\n    output: &#123;\n        path: path.resolve(__dirname, &#39;..&#x2F;dist&#39;),\n        filename: &#39;[name].min.js&#39;,\n        library: &#39;mars_mg_sdk&#39;,\n        libraryTarget: &quot;umd&quot;\n    &#125;,\n    module: &#123;\n        rules: [\n            &#123; \n                test: &#x2F;\\.js$&#x2F;, \n                exclude: &#x2F;node_modules&#x2F;, \n                use: &#123;\n                    loader: &quot;babel-loader&quot; \n                &#125;\n            &#125;\n        ]\n    &#125;,\n    resolve: &#123;\n        alias: &#123;\n            &#39;@&#39;: path.resolve(&#39;src&#39;)\n        &#125;\n    &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>config\\webpack.development.js</code></p>\n<pre class=\"line-numbers language-JavaScript\" data-language=\"JavaScript\"><code class=\"language-JavaScript\">const merge &#x3D; require(&quot;webpack-merge&quot;);\nmodule.exports &#x3D; &#123;\n    devtool: &#39;source-map&#39;,\n    output: &#123;\n        filename: &#39;[name].js&#39;,\n    &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>config\\webpack.production.js</code></p>\n<pre class=\"line-numbers language-JavaScript\" data-language=\"JavaScript\"><code class=\"language-JavaScript\">const merge &#x3D; require(&quot;webpack-merge&quot;);\nmodule.exports &#x3D; &#123;\n    output: &#123;\n        filename: &#39;[name].min.js&#39;,\n    &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>webpack.config.js</code></p>\n<pre class=\"line-numbers language-JavaScript\" data-language=\"JavaScript\"><code class=\"language-JavaScript\">const merge &#x3D; require(&#39;webpack-merge&#39;);\nconst baseConfig &#x3D; require(&#39;.&#x2F;config&#x2F;webpack.base&#39;);\nconst developmentConfig &#x3D; require(&#39;.&#x2F;config&#x2F;webpack.development&#39;);\nconst productionConfig &#x3D; require(&#39;.&#x2F;config&#x2F;webpack.production&#39;);\n\nmodule.exports &#x3D; mode &#x3D;&gt; &#123;\n    if (mode &#x3D;&#x3D;&#x3D; &quot;production&quot;) &#123;\n        return merge(baseConfig, productionConfig, &#123; mode &#125;);\n    &#125;\n    return merge(baseConfig, developmentConfig, &#123; mode &#125;);\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>package.json</code></p>\n<pre class=\"line-numbers language-Json\" data-language=\"Json\"><code class=\"language-Json\">&#123;\n  &quot;name&quot;: &quot;mars_mg_sdk&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;description&quot;: &quot;火星救援小游戏SDK&quot;,\n  &quot;private&quot;: true,\n  &quot;scripts&quot;: &#123;\n    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;,\n    &quot;start&quot;: &quot;npm run dev&quot;,\n    &quot;dev&quot;: &quot;webpack --watch --env development&quot;,\n    &quot;build&quot;: &quot;webpack --env production&quot;,\n    &quot;server&quot;: &quot;webpack-dev-server --open --env development&quot;\n  &#125;,\n  &quot;repository&quot;: &#123;\n    &quot;type&quot;: &quot;git&quot;,\n    &quot;url&quot;: &quot;ssh:&#x2F;&#x2F;git@gitlab.mars.com&#x2F;lcpd&#x2F;mars_mg_sdk.git&quot;\n  &#125;,\n  &quot;keywords&quot;: [\n    &quot;火星救援&quot;,\n    &quot;小游戏&quot;,\n    &quot;SDK&quot;\n  ],\n  &quot;author&quot;: &quot;Mars Developer&quot;,\n  &quot;license&quot;: &quot;MIT&quot;,\n  &quot;dependencies&quot;: &#123;&#125;,\n  &quot;devDependencies&quot;: &#123;\n    &quot;@babel&#x2F;core&quot;: &quot;^7.5.4&quot;,\n    &quot;babel-loader&quot;: &quot;^8.0.6&quot;,\n    &quot;uglifyjs-webpack-plugin&quot;: &quot;^2.1.3&quot;,\n    &quot;webpack&quot;: &quot;^4.35.3&quot;,\n    &quot;webpack-cli&quot;: &quot;^3.3.5&quot;,\n    &quot;webpack-dev-server&quot;: &quot;^3.7.2&quot;,\n    &quot;webpack-merge&quot;: &quot;^4.2.1&quot;\n  &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"业务代码\"><a href=\"#业务代码\" class=\"headerlink\" title=\"业务代码\"></a>业务代码</h3><p><code>index.js</code></p>\n<pre class=\"line-numbers language-JavaScript\" data-language=\"JavaScript\"><code class=\"language-JavaScript\">const qqSdk &#x3D; require(&#39;.&#x2F;sdk&#x2F;qq&#39;);\nconst wechatSdk &#x3D; require(&#39;.&#x2F;sdk&#x2F;wechat&#39;);\nconst util &#x3D; require(&#39;.&#x2F;lib&#x2F;util&#39;);\n\nwindow.apiHost &#x3D; &#39;https:&#x2F;&#x2F;api.mp.mars.com&#x2F;&#39;;\n\nmodule.exports &#x3D; &#123;\n    init: function (e) &#123;&#125;,\n    login: function (e) &#123;&#125;,\n    pay: function (e) &#123;&#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>sdk\\wechat.js</code></p>\n<pre class=\"line-numbers language-JavaScript\" data-language=\"JavaScript\"><code class=\"language-JavaScript\">const util &#x3D; require(&#39;..&#x2F;lib&#x2F;util&#39;);\n\nmodule.exports &#x3D; &#123;\n    init: function (e) &#123;&#125;,\n    login: function (e) &#123;&#125;,\n    pay: function (e) &#123;&#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"打包\"><a href=\"#打包\" class=\"headerlink\" title=\"打包\"></a>打包</h3><p>打包开发环境文件，即打包成<code>mars_minigame_sdk.js</code>。启动命令参数加了<code>--watch</code>，文件改动时会自动打包。</p>\n<pre class=\"line-numbers language-Shell\" data-language=\"Shell\"><code class=\"language-Shell\">npm run dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/61350182-57528800-a899-11e9-84b5-4aed02fcb550.png\" alt=\"image\"></p>\n<p>打包生产环境文件，即<code>mars_minigame_sdk.min.js</code></p>\n<pre class=\"line-numbers language-Shell\" data-language=\"Shell\"><code class=\"language-Shell\">npm run build<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/61350264-8a951700-a899-11e9-8c48-34209c8a14b7.png\" alt=\"image\"></p>\n<h3 id=\"使用SDK\"><a href=\"#使用SDK\" class=\"headerlink\" title=\"使用SDK\"></a>使用SDK</h3><p>以微信开发工具为例</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/61350545-77367b80-a89a-11e9-94b0-f18ac26bcc3d.png\" alt=\"image\"></p>\n<h3 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h3><p><a href=\"https://www.baidu.com/link?url=4DZ9UT62RPwYlUbKHWxePeWuWZHGMpRXPSctLMLJSj3Sze_Qwndoshs_6frPE3cnjbm47ZCT2Cp3SvenusCws_&wd=&eqid=ccfe98200005b7d8000000065d37ff52\">用 webpack 写一个简单的 JS SDK</a></p>\n","text":"最近项目需要开发一个JS Sdk，为了保证可读性与可维护性，决定按模块开发，最后使用webpack打包。 文件结构|-- config | |-- webpack.base.js | |-- webpack.development.js | |-- webpack.product...","link":"","photos":[],"count_time":{"symbolsCount":"4.7k","symbolsTime":"4 mins."},"categories":[{"name":"前端","slug":"前端","count":4,"path":"api/categories/前端.json"}],"tags":[{"name":"webpack","slug":"webpack","count":2,"path":"api/tags/webpack.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">文件结构</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">安装依赖</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEwebpack\"><span class=\"toc-text\">配置webpack</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">业务代码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%89%93%E5%8C%85\"><span class=\"toc-text\">打包</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8SDK\"><span class=\"toc-text\">使用SDK</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#References\"><span class=\"toc-text\">References</span></a></li></ol>","author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"}}}},"mapped":true,"prev_post":{"title":"用Docker搭建LNMP环境","uid":"50cf5c76074e26e315ae86b2cbee0e59","slug":"用Docker搭建LNMP环境","date":"2019-07-19T09:57:13.000Z","updated":"2021-06-04T03:18:11.682Z","comments":true,"path":"api/articles/用Docker搭建LNMP环境.json","cover":"https://xmyunwei.com/wp-content/uploads/2020/10/docker-lnmp.png","text":"人类的本质是复读机。 安装docker查看内核版本$ uname -r 3.10.0-957.el7.x86_64 更新yum包$ yum update 添加包源$ yum-config-manager --add-repo https://download.docker.com...","link":"","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"运维","slug":"运维","count":1,"path":"api/categories/运维.json"}],"tags":[{"name":"docker","slug":"docker","count":1,"path":"api/tags/docker.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"}}}}},"next_post":{"title":"Laravel5.8+Dingo+JWT+Swagger 开发API","uid":"58d4f495b2526d01b8b9004566be2a59","slug":"Laravel5-8-Dingo-JWT-Swagger-开发API","date":"2019-06-03T06:03:45.000Z","updated":"2021-06-04T03:18:11.680Z","comments":true,"path":"api/articles/Laravel5-8-Dingo-JWT-Swagger-开发API.json","cover":"https://i.pinimg.com/originals/bd/c4/7c/bdc47c05192f45e6fe2704b3c52995e7.jpg","text":"在Laravel5.8中使用“Laravel必知必会”的两个轮子dingo/api和tymon/jwt-auth以及文档系统swagger-api/swagger-ui开发一个规范优雅的API。 Dingo安装composer require dingo&#x2F;api 组件包...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[{"name":"laravel","slug":"laravel","count":9,"path":"api/tags/laravel.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"}}}}}}