{"title":"如何引用同一级查询的列别名作为新列","uid":"0abd40c040136e2dd273f02ae6ffdae7","slug":"如何引用同一级查询的列别名作为新列","date":"2019-08-03T15:46:21.000Z","updated":"2021-06-04T10:30:25.045Z","comments":true,"path":"api/articles/如何引用同一级查询的列别名作为新列.json","cover":"https://fs.buttercms.com/resize=width:940/BzVPXsRRQh2CF2GF8uKF","content":"<p>火星救援，刻不容缓！</p>\n<span id=\"more\"></span>\n<p>示例表：</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">mysql<span class=\"token operator\">></span> SELECT * FROM core<span class=\"token punctuation\">;</span>\n+--------+--------+--------+\n<span class=\"token operator\">|</span> field1 <span class=\"token operator\">|</span> field2 <span class=\"token operator\">|</span> field3 <span class=\"token operator\">|</span>\n+--------+--------+--------+\n<span class=\"token operator\">|</span>      <span class=\"token number\">1</span> <span class=\"token operator\">|</span>      <span class=\"token number\">2</span> <span class=\"token operator\">|</span>      <span class=\"token number\">3</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>      <span class=\"token number\">4</span> <span class=\"token operator\">|</span>      <span class=\"token number\">5</span> <span class=\"token operator\">|</span>      <span class=\"token number\">6</span> <span class=\"token operator\">|</span>\n+--------+--------+--------+\n<span class=\"token number\">2</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>MySQL</code>中无法直接执行以下查询：</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">mysql<span class=\"token operator\">></span> SELECT\n    -<span class=\"token operator\">></span>     field1 + field2 AS col1,\n    -<span class=\"token operator\">></span>     col1 + field3 AS col2\n    -<span class=\"token operator\">></span> FROM\n    -<span class=\"token operator\">></span>     core<span class=\"token punctuation\">;</span>\nERROR <span class=\"token number\">1054</span> <span class=\"token punctuation\">(</span>42S22<span class=\"token punctuation\">)</span>: Unknown <span class=\"token function\">column</span> <span class=\"token string\">'col1'</span> <span class=\"token keyword\">in</span> <span class=\"token string\">'field list'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>但有三种方案实现这个效果。</p>\n<h3 id=\"子查询\"><a href=\"#子查询\" class=\"headerlink\" title=\"子查询\"></a>子查询</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">mysql<span class=\"token operator\">></span> SELECT\n    -<span class=\"token operator\">></span>     col1,\n    -<span class=\"token operator\">></span>     col1 + field3 AS col2\n    -<span class=\"token operator\">></span> FROM\n    -<span class=\"token operator\">></span>     <span class=\"token punctuation\">(</span> SELECT field1 + field2 AS col1, field3 FROM core <span class=\"token punctuation\">)</span> AS subQuery<span class=\"token punctuation\">;</span>\n+------+------+\n<span class=\"token operator\">|</span> col1 <span class=\"token operator\">|</span> col2 <span class=\"token operator\">|</span>\n+------+------+\n<span class=\"token operator\">|</span>    <span class=\"token number\">3</span> <span class=\"token operator\">|</span>    <span class=\"token number\">6</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>    <span class=\"token number\">9</span> <span class=\"token operator\">|</span>   <span class=\"token number\">15</span> <span class=\"token operator\">|</span>\n+------+------+\n<span class=\"token number\">2</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"用户变量\"><a href=\"#用户变量\" class=\"headerlink\" title=\"用户变量\"></a>用户变量</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">mysql<span class=\"token operator\">></span> SELECT\n    -<span class=\"token operator\">></span>     @col1 :<span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> field1 + field2 <span class=\"token punctuation\">)</span> AS col1,\n    -<span class=\"token operator\">></span>     @col1 + field3 AS col2\n    -<span class=\"token operator\">></span> FROM\n    -<span class=\"token operator\">></span>     core<span class=\"token punctuation\">;</span>\n+------+------+\n<span class=\"token operator\">|</span> col1 <span class=\"token operator\">|</span> col2 <span class=\"token operator\">|</span>\n+------+------+\n<span class=\"token operator\">|</span>    <span class=\"token number\">3</span> <span class=\"token operator\">|</span>    <span class=\"token number\">6</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>    <span class=\"token number\">9</span> <span class=\"token operator\">|</span>   <span class=\"token number\">15</span> <span class=\"token operator\">|</span>\n+------+------+\n<span class=\"token number\">2</span> rows <span class=\"token keyword\">in</span> set, <span class=\"token number\">1</span> warning <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<div class=\"note warning\"><p>这里结果显示了一个warning: SELECT里的表达式在被发送到mysql客户端时才会被执行，所以[用户变量](https://dev.mysql.com/doc/refman/5.6/en/user-variables.html)在`HAVING`、`GROUP BY`、`ORDER BY`中无法使用。</p></div>\n\n<h3 id=\"引用别名\"><a href=\"#引用别名\" class=\"headerlink\" title=\"引用别名\"></a>引用别名</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">mysql<span class=\"token operator\">></span> SELECT\n    -<span class=\"token operator\">></span>     field1 + field2 AS col1,\n    -<span class=\"token operator\">></span>     <span class=\"token punctuation\">(</span> SELECT col1 <span class=\"token punctuation\">)</span> + field3 AS col2\n    -<span class=\"token operator\">></span> FROM\n    -<span class=\"token operator\">></span>     core<span class=\"token punctuation\">;</span>\n+------+------+\n<span class=\"token operator\">|</span> col1 <span class=\"token operator\">|</span> col2 <span class=\"token operator\">|</span>\n+------+------+\n<span class=\"token operator\">|</span>    <span class=\"token number\">3</span> <span class=\"token operator\">|</span>    <span class=\"token number\">6</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>    <span class=\"token number\">9</span> <span class=\"token operator\">|</span>   <span class=\"token number\">15</span> <span class=\"token operator\">|</span>\n+------+------+\n<span class=\"token number\">2</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<div class=\"note warning\"><p>与`用户变量`类似，在`GROUP BY`中无法使用。</p></div>\n\n<p>在<code>GROUP BY</code>里中使用引用:</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">mysql<span class=\"token operator\">></span> SELECT\n    -<span class=\"token operator\">></span>     MAX<span class=\"token punctuation\">(</span> field1 <span class=\"token punctuation\">)</span> AS col1,\n    -<span class=\"token operator\">></span>     <span class=\"token punctuation\">(</span> SELECT col1 <span class=\"token punctuation\">)</span> AS col2\n    -<span class=\"token operator\">></span> FROM\n    -<span class=\"token operator\">></span>     core\n    -<span class=\"token operator\">></span> GROUP BY\n    -<span class=\"token operator\">></span>     field1<span class=\"token punctuation\">;</span>\nERROR <span class=\"token number\">1247</span> <span class=\"token punctuation\">(</span>42S22<span class=\"token punctuation\">)</span>: Reference <span class=\"token string\">'col1'</span> not supported <span class=\"token punctuation\">(</span>reference to group <span class=\"token keyword\">function</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h3><p><a href=\"https://stackoverflow.com/questions/6081436/how-to-alias-a-field-or-column-in-mysql#\">https://stackoverflow.com/questions/6081436/how-to-alias-a-field-or-column-in-mysql#</a></p>\n","text":"火星救援，刻不容缓！ 示例表： mysql> SELECT * FROM core; +--------+--------+--------+ | field1 | field2 | field3 | +--------+--------+--------+ | 1 | 2 | ...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"db","slug":"db","count":1,"path":"api/categories/db.json"}],"tags":[{"name":"mysql","slug":"mysql","count":2,"path":"api/tags/mysql.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AD%90%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">子查询</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F\"><span class=\"toc-text\">用户变量</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BC%95%E7%94%A8%E5%88%AB%E5%90%8D\"><span class=\"toc-text\">引用别名</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#References\"><span class=\"toc-text\">References</span></a></li></ol>","author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}},"mapped":true,"prev_post":{"title":"Eloquent自动维护int类型的时间","uid":"76ef2e250c5014c401277f737e1b27cf","slug":"Eloquent自动维护int类型的时间","date":"2020-08-12T03:20:16.000Z","updated":"2021-06-04T10:30:25.045Z","comments":true,"path":"api/articles/Eloquent自动维护int类型的时间.json","cover":"https://cdn.shouts.dev/wp-content/uploads/2020/08/14223540/some-useful-timestamp-tricks-in-laravel.png","text":"火星救援，刻不容缓！ Laravel Eloquent提供了自动维护created_at、updated_at的功能，时间的默认类型为格式化的字符串(Carbon\\Carbon::toString()的返回值)。如果表设计是存储Unix时间戳，可以通过一个trait支持。 nam...","link":"","photos":[],"count_time":{"symbolsCount":561,"symbolsTime":"1 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[{"name":"laravel","slug":"laravel","count":9,"path":"api/tags/laravel.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}}},"next_post":{"title":"用Docker搭建LNMP环境","uid":"50cf5c76074e26e315ae86b2cbee0e59","slug":"用Docker搭建LNMP环境","date":"2019-07-19T09:57:13.000Z","updated":"2021-06-04T10:30:25.044Z","comments":true,"path":"api/articles/用Docker搭建LNMP环境.json","cover":"https://xmyunwei.com/wp-content/uploads/2020/10/docker-lnmp.png","text":"人类的本质是复读机。 安装docker查看内核版本$ uname -r 3.10.0-957.el7.x86_64 更新yum包$ yum update 添加包源$ yum-config-manager --add-repo https://download.docker.com...","link":"","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"运维","slug":"运维","count":1,"path":"api/categories/运维.json"}],"tags":[{"name":"docker","slug":"docker","count":1,"path":"api/tags/docker.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}}}}