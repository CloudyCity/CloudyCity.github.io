{"title":"PHP强制规范检查的最佳实践","uid":"7383adf578f96139725a89cef1cef06f","slug":"PHP强制规范检查的最佳实践","date":"2021-01-29T08:25:35.000Z","updated":"2021-06-04T10:30:25.045Z","comments":true,"path":"api/articles/PHP强制规范检查的最佳实践.json","cover":"https://d1xmlzncnovrpo.cloudfront.net/sites/default/files/public/blog-image/PHP_CodeSniffer-Ignoring-Standards.jpg","content":"<p>规范是团队中最重要的部分之一，多数团队是靠自觉+review维护规范，而强制检查是最有效的方案。<br>本文就<del>水一下</del>介绍下<a href=\"https://github.com/squizlabs/PHP_CodeSniffer\">PHP_CodeSniffer</a>在项目中强制执行的最佳实践。</p>\n<span id=\"more\"></span>\n\n<p>规范检查和表单检验一样，服务端是必须要检查的，客户端检查主要是优化使用体验。</p>\n<h3 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h3><h4 id=\"引入组件\"><a href=\"#引入组件\" class=\"headerlink\" title=\"引入组件\"></a>引入组件</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">$ composer <span class=\"token keyword\">require</span> <span class=\"token string single-quoted-string\">'squizlabs/php_codesniffer'</span> <span class=\"token operator\">--</span>dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"自定义规范\"><a href=\"#自定义规范\" class=\"headerlink\" title=\"自定义规范\"></a>自定义规范</h4><p>如果你的项目用的是<code>Laravel</code>框架，会发现它并没有完全遵守PSR2规范，这时候就需要使用自定义规范。<br>在项目根目录创建<code>phpcs.xml</code>作为自定义规范，这里放出我的项目的例子。</p>\n<pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ruleset</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MyStandard<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>description</span><span class=\"token punctuation\">></span></span>基于PSR2，去掉部分规则<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>description</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tab-width<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PSR2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- 不限制行的长度 --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Generic.Files.LineLength<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token comment\">&lt;!-- 跳过的目录 --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>bootstrap/cache/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>node_modules/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>public/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>resources/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>storage/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>vendor/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">&lt;!-- Laravel Migration &amp; Seeder 没有命名空间 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PSR1.Classes.ClassDeclaration<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>database/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ruleset</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"配置命令\"><a href=\"#配置命令\" class=\"headerlink\" title=\"配置命令\"></a>配置命令</h4><p>我的使用场景只检查php，为了加快执行速度，跳过了部分目录。<br>加上这些参数之后命令会比较长，先加入到composer.json的脚本中，方便执行。</p>\n<p><code>composer.json</code></p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">\"phpcs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"./vendor/bin/phpcs --extensions='php' --standard='./phpcs.xml' --ignore='*/bootstrap/*,*/docker/*,*/node_modules/*,*/public/*,*/resources/*,*/storage/*,*/vendor/*,_ide_helper*,*.blade.php' -p\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"phpcbf\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"./vendor/bin/phpcbf --extensions='php' --standard='./phpcs.xml' --ignore='*/bootstrap/*,*/docker/*,*/node_modules/*,*/public/*,*/resources/*,*/storage/*,*/vendor/*,_ide_helper*,*.blade.php' -p\"</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"手动执行\"><a href=\"#手动执行\" class=\"headerlink\" title=\"手动执行\"></a>手动执行</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">$ composer phpcs <span class=\"token operator\">.</span><span class=\"token operator\">/</span>\n$ composer phpcbf <span class=\"token operator\">.</span><span class=\"token operator\">/</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106257261-4426c380-6257-11eb-9efd-886c2ebb77e5.png\" alt=\"image\"></p>\n<h4 id=\"自动执行\"><a href=\"#自动执行\" class=\"headerlink\" title=\"自动执行\"></a>自动执行</h4><p>通过<code>pre-commit</code>钩子，在提交时自动执行<code>phpcs</code>进行检查，如果未通过检查将阻止提交。</p>\n<p>在项目根目录创建<code>git-pre-commit-hook</code>:</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token assign-left variable\">PROJECT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span>php -r <span class=\"token string\">\"echo dirname(dirname(dirname(realpath('<span class=\"token variable\">$0</span>'))));\"</span><span class=\"token variable\">`</span></span>\n<span class=\"token assign-left variable\">STAGED_FILES_CMD</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">git</span> <span class=\"token function\">diff</span> --cached --name-only --diff-filter<span class=\"token operator\">=</span>ACMR HEAD <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span>.php<span class=\"token variable\">`</span></span>\n\n<span class=\"token comment\"># Determine if a file list is passed</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$#</span>\"</span> -eq <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">oIFS</span><span class=\"token operator\">=</span><span class=\"token environment constant\">$IFS</span>\n    <span class=\"token assign-left variable\"><span class=\"token environment constant\">IFS</span></span><span class=\"token operator\">=</span><span class=\"token string\">'\n    '</span>\n    <span class=\"token assign-left variable\">SFILES</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span>\n    <span class=\"token assign-left variable\"><span class=\"token environment constant\">IFS</span></span><span class=\"token operator\">=</span><span class=\"token variable\">$oIFS</span>\n<span class=\"token keyword\">fi</span>\n<span class=\"token assign-left variable\">SFILES</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;SFILES<span class=\"token operator\">:-</span>$STAGED_FILES_CMD&#125;</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Checking PHP Lint...\"</span>\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">FILE</span> <span class=\"token keyword\">in</span> <span class=\"token variable\">$SFILES</span>\n<span class=\"token keyword\">do</span>\n    php -l -d <span class=\"token assign-left variable\">display_errors</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token variable\">$PROJECT</span>/<span class=\"token variable\">$FILE</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Fix the error before commit.\"</span>\n        <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">fi</span>\n    <span class=\"token assign-left variable\">FILES</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$FILES</span> <span class=\"token variable\">$PROJECT</span>/<span class=\"token variable\">$FILE</span>\"</span>\n<span class=\"token keyword\">done</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$FILES</span>\"</span> <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Running Code Sniffer. Code standard PSR2.\"</span>\n    <span class=\"token function\">composer</span> phpcs -- <span class=\"token variable\">$FILES</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Fix the error before commit!\"</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Run\"</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"  composer phpcbf -- <span class=\"token variable\">$FILES</span>\"</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"for automatic fix or fix it manually.\"</span>\n        <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token builtin class-name\">exit</span> <span class=\"token variable\">$?</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>同样是在项目根目录创建<code>git-hook-setup.sh</code>，用于安装钩子:</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> -e .git/hooks/pre-commit <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">PRE_COMMIT_EXISTS</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token assign-left variable\">PRE_COMMIT_EXISTS</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">cp</span> ./git-pre-commit-hook .git/hooks/pre-commit\n<span class=\"token function\">chmod</span> +x .git/hooks/pre-commit\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$PRE_COMMIT_EXISTS</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Pre-commit git hook is installed!\"</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Pre-commit git hook is updated!\"</span>\n<span class=\"token keyword\">fi</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>在<code>composer.json</code>的钩子中加入git钩子的安装脚本 <del>禁止套娃</del></p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">\"install-hooks\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"sh ./git-hook-setup.sh\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"post-install-cmd\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"@install-hooks\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>每一位开发者在克隆项目后都会执行<code>composer install</code>，安装完依赖就会自动安装git钩子，从而实现自动检查。</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106257419-77695280-6257-11eb-87e2-0fea0e1aa18b.png\" alt=\"image\"></p>\n<p>使用命令行提交被拒:</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106256931-e1352c80-6256-11eb-9cf7-87d60fff98b0.png\" alt=\"image\"></p>\n<p>正常安装钩子后，使用PHPStorm提交时将出现<code>Run Git hooks</code>选项并且默认勾选，如果没有，就重启大法。</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106256694-93202900-6256-11eb-9496-0120aa2c30a8.png\" alt=\"image\"></p>\n<p>使用PHPStorm提交被拒:</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106257783-fb233f00-6257-11eb-84f3-517c2e256861.png\" alt=\"image\"></p>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">提示</p>\n<p>虽然客户端有办法跳过自动检查，不过后面服务端也会进行检查，不必担心。客户端检查主要是提高用户体验，也可以杜绝不规范的提交。</p>\n</div>\n<h4 id=\"PHPStorm协同\"><a href=\"#PHPStorm协同\" class=\"headerlink\" title=\"PHPStorm协同\"></a>PHPStorm协同</h4><p>正常来说，在引入PHPCS组件后，PHPStorm会自动发现配置。如果没有自动配置，需要在 <strong>Languages &amp; Frameworks &gt; PHP &gt; Quality Tools &gt; Code Sniffer</strong> 中配置。</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106248641-3b7cc000-624c-11eb-8ed4-5731ed61c234.png\" alt=\"image\"></p>\n<p>不过这时候默认是使用PSR2规范，需要手动选择一下自定义的规范。<br>在 <strong>Editor &gt; Inspections &gt; PHP &gt; Quality tools &gt; PHP Code Sniffer validation</strong> 中，将<code>Coding standard</code>改为了<code>Custom</code>，并点击冒号图标，选中项目根目录的<code>phpcs.xml</code>。</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106248118-80542700-624b-11eb-9f61-35c53195b272.png\" alt=\"image\"></p>\n<p>保存后重启PHPStorm以生效。</p>\n<h3 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h3><p>精力有限，这里只介绍我们团队用的GitLab的方案。其他的托管仓库只要支持Hook都能实现。</p>\n<h4 id=\"GitLab\"><a href=\"#GitLab\" class=\"headerlink\" title=\"GitLab\"></a>GitLab</h4><p>首先进入GitLab所在终端，找到存放所有仓库的目录。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ <span class=\"token function\">cat</span> /etc/gitlab/gitlab.rb <span class=\"token operator\">|</span><span class=\"token function\">grep</span> git_data_dirs -A <span class=\"token number\">4</span>\ngit_data_dirs<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n   <span class=\"token string\">\"default\"</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span>\n     <span class=\"token string\">\"path\"</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"/data/gitlab\"</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>然后进入项目所在仓库目录，创建<code>custom_hooks</code>目录，并在该目录中创建<code>pre-receive</code>:</p>\n<details class=\"custom-details\">\n<summary>Click to see more</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n \n<span class=\"token comment\"># 创建临时目录</span>\n<span class=\"token assign-left variable\">TMP_DIR</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>mktemp -d<span class=\"token variable\">)</span></span>\n<span class=\"token comment\"># 删除临时目录(脚本退出时)</span>\n<span class=\"token builtin class-name\">trap</span> <span class=\"token string\">'rm -rf \"<span class=\"token variable\">$TMP_DIR</span>\"'</span> <span class=\"token builtin class-name\">exit</span>\n \n<span class=\"token comment\"># 警告数</span>\n<span class=\"token assign-left variable\">warnings_count</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n<span class=\"token comment\"># 错误数</span>\n<span class=\"token assign-left variable\">errors_count</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n<span class=\"token comment\"># 自定义规范</span>\n<span class=\"token assign-left variable\">custom_standard</span><span class=\"token operator\">=</span><span class=\"token string\">'phpcs.xml'</span>\n \n<span class=\"token comment\"># 空hash</span>\n<span class=\"token assign-left variable\">EMPTY_REF</span><span class=\"token operator\">=</span><span class=\"token string\">'0000000000000000000000000000000000000000'</span>\n \n<span class=\"token comment\"># Colors</span>\n<span class=\"token assign-left variable\">PURPLE</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[35m'</span>\n<span class=\"token assign-left variable\">RED</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[31m'</span>\n<span class=\"token assign-left variable\">RED_BOLD</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[1;31m'</span>\n<span class=\"token assign-left variable\">YELLOW</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[33m'</span>\n<span class=\"token assign-left variable\">YELLOW_BOLD</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[1;33m'</span>\n<span class=\"token assign-left variable\">GREEN</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[32m'</span>\n<span class=\"token assign-left variable\">GREEN_BOLD</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[1;32m'</span>\n<span class=\"token assign-left variable\">BLUE</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[34m'</span>\n<span class=\"token assign-left variable\">BLUE_BOLD</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[1;34m'</span>\n<span class=\"token assign-left variable\">COLOR_END</span><span class=\"token operator\">=</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\033\">\\033</span>[0m'</span>\n \n<span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">read</span> oldrev newrev ref\n<span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># 当push新分支的时候oldrev会不存在，删除时newrev就不存在</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$oldrev</span> <span class=\"token operator\">!=</span> <span class=\"token variable\">$EMPTY_REF</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$newrev</span> <span class=\"token operator\">!=</span> <span class=\"token variable\">$EMPTY_REF</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> -e <span class=\"token string\">\"<span class=\"token entity\" title=\"\\n\">\\n</span><span class=\"token variable\">$&#123;PURPLE&#125;</span>CodeSniffer check result:<span class=\"token variable\">$&#123;COLOR_END&#125;</span>\"</span>\n        <span class=\"token comment\"># 取最新版本的自定义规则，不存在则使用PSR2</span>\n        <span class=\"token function\">git</span> show <span class=\"token variable\">$newrev</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$custom_standard</span> <span class=\"token operator\">></span> <span class=\"token variable\">$TMP_DIR</span>/<span class=\"token variable\">$custom_standard</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n            <span class=\"token assign-left variable\">standard</span><span class=\"token operator\">=</span><span class=\"token string\">'PSR2'</span>\n        <span class=\"token keyword\">else</span>\n            <span class=\"token assign-left variable\">standard</span><span class=\"token operator\">=</span><span class=\"token variable\">$TMP_DIR</span>/<span class=\"token variable\">$custom_standard</span>\n        <span class=\"token keyword\">fi</span>\n        <span class=\"token comment\"># 被检查了的文件数</span>\n        <span class=\"token assign-left variable\">checked_file_count</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n        <span class=\"token comment\"># 找出哪些文件被更新了</span>\n        <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">line</span> <span class=\"token keyword\">in</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> diff-tree -r $oldrev<span class=\"token punctuation\">..</span>$newrev <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -oP <span class=\"token string\">'.*\\.(php)'</span> <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'&#123;print <span class=\"token variable\">$5</span><span class=\"token variable\">$6</span>&#125;'</span><span class=\"token variable\">)</span></span>\n        <span class=\"token keyword\">do</span>\n            <span class=\"token comment\"># 文件状态</span>\n            <span class=\"token comment\"># D: deleted</span>\n            <span class=\"token comment\"># A: added</span>\n            <span class=\"token comment\"># M: modified</span>\n            <span class=\"token assign-left variable\">status</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $line <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -o <span class=\"token string\">'^.'</span><span class=\"token variable\">)</span></span>\n \n            <span class=\"token comment\"># 不检查被删除的文件</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$status</span> <span class=\"token operator\">==</span> <span class=\"token string\">'D'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n                <span class=\"token builtin class-name\">continue</span>\n            <span class=\"token keyword\">fi</span>\n \n            <span class=\"token comment\"># 文件名</span>\n            <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $line <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/^.//'</span><span class=\"token variable\">)</span></span>\n \n            <span class=\"token comment\"># 为文件创建目录</span>\n            <span class=\"token function\">mkdir</span> -p <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">dirname</span> $TMP_DIR/$file<span class=\"token variable\">)</span></span>\n            <span class=\"token comment\"># 保存文件内容</span>\n            <span class=\"token function\">git</span> show <span class=\"token variable\">$newrev</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$file</span> <span class=\"token operator\">></span> <span class=\"token variable\">$TMP_DIR</span>/<span class=\"token variable\">$file</span>\n \n            <span class=\"token assign-left variable\">output</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>phpcs --standard<span class=\"token operator\">=</span>$standard --colors --encoding<span class=\"token operator\">=</span>utf-8 -n -p  $TMP_DIR/$file<span class=\"token variable\">)</span></span>\n \n            <span class=\"token assign-left variable\">warning</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $output <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -oP <span class=\"token string\">'([0-9]+) WARNING'</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -oP <span class=\"token string\">'[0-9]+'</span><span class=\"token variable\">)</span></span>\n            <span class=\"token assign-left variable\">error</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $output <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -oP <span class=\"token string\">'([0-9]+) ERROR'</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -oP <span class=\"token string\">'[0-9]+'</span><span class=\"token variable\">)</span></span>\n \n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$warning</span> <span class=\"token operator\">||</span> <span class=\"token variable\">$error</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n \n                <span class=\"token assign-left variable\">msg</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$&#123;file&#125;</span>: \"</span>\n \n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$warning</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n                    <span class=\"token assign-left variable\">msg</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$msg</span><span class=\"token variable\">$&#123;YELLOW_BOLD&#125;</span><span class=\"token variable\">$&#123;warning&#125;</span><span class=\"token variable\">$&#123;COLOR_END&#125;</span> <span class=\"token variable\">$&#123;YELLOW&#125;</span>warnings<span class=\"token variable\">$&#123;COLOR_END&#125;</span> \"</span>\n \n                    <span class=\"token builtin class-name\">let</span> <span class=\"token string\">\"warnings_count = warnings_count + 1\"</span>\n                <span class=\"token keyword\">fi</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$error</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n                    <span class=\"token assign-left variable\">msg</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$msg</span><span class=\"token variable\">$&#123;RED_BOLD&#125;</span><span class=\"token variable\">$&#123;error&#125;</span><span class=\"token variable\">$&#123;COLOR_END&#125;</span> <span class=\"token variable\">$&#123;RED&#125;</span>errors<span class=\"token variable\">$&#123;COLOR_END&#125;</span>\"</span>\n \n                    <span class=\"token builtin class-name\">let</span> <span class=\"token string\">\"errors_count = errors_count + 1\"</span>\n                <span class=\"token keyword\">fi</span>\n \n                <span class=\"token builtin class-name\">echo</span> -e <span class=\"token string\">\"    <span class=\"token variable\">$msg</span>\"</span>\n            <span class=\"token keyword\">fi</span>\n \n            <span class=\"token builtin class-name\">let</span> <span class=\"token string\">\"checked_file_count = checked_file_count + 1\"</span><span class=\"token punctuation\">;</span>\n \n        <span class=\"token keyword\">done</span>\n \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$checked_file_count</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n            <span class=\"token builtin class-name\">echo</span> -e <span class=\"token string\">\"    <span class=\"token variable\">$&#123;BLUE_BOLD&#125;</span>No file was checked.<span class=\"token variable\">$&#123;COLOR_END&#125;</span>\"</span>\n        <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$warnings_count</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$errors_count</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n            <span class=\"token builtin class-name\">echo</span> -e <span class=\"token string\">\"<span class=\"token variable\">$&#123;GREEN_BOLD&#125;</span><span class=\"token variable\"><span class=\"token variable\">$(</span>cowsay <span class=\"token string\">'Congratulations!!!'</span><span class=\"token variable\">)</span></span><span class=\"token variable\">$&#123;COLOR_END&#125;</span>\"</span>\n        <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$errors_count</span>  <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n            <span class=\"token builtin class-name\">echo</span> -e <span class=\"token string\">\"    <span class=\"token variable\">$&#123;BLUE&#125;</span>Good job, no errors were found!!!<span class=\"token variable\">$&#123;COLOR_END&#125;</span>\"</span>\n        <span class=\"token keyword\">fi</span>\n         \n    <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">done</span>\n \n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$warnings_count</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> <span class=\"token variable\">$errors_count</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> -e <span class=\"token string\">\"<span class=\"token variable\">$&#123;RED&#125;</span><span class=\"token variable\"><span class=\"token variable\">$(</span>cowsay -f dragon <span class=\"token string\">'PHPCS Check Error!!!'</span><span class=\"token variable\">)</span></span><span class=\"token variable\">$&#123;COLOR_END&#125;</span>\"</span>\n    <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">fi</span>\n \n<span class=\"token builtin class-name\">exit</span> <span class=\"token number\">0</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>之后客户端推送提交时，便会执行这个钩子进行检查。</p>\n<p>推送通过:</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106252564-5e5da300-6251-11eb-999b-c069638a7c82.png\" alt=\"image\"></p>\n<p>推送被拒:</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106252728-864d0680-6251-11eb-97c6-8b4372e0353b.png\" alt=\"image\"></p>\n<p>如果使用PHPStorm的UI进行推送，被拒是不提示原因的，不过相信大家心里一般都有b数的。</p>\n<p><img src=\"https://user-images.githubusercontent.com/17662451/106257905-2443cf80-6258-11eb-9826-8e8aca02452a.png\" alt=\"image\"></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"> _____________________________ \n<span class=\"token operator\">&lt;</span> 你心里没点b数吗？ <span class=\"token operator\">></span>\n ----------------------------- \n        <span class=\"token punctuation\">\\</span>   ^__^\n         <span class=\"token punctuation\">\\</span>  <span class=\"token punctuation\">(</span>oo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">\\</span>_______\n            <span class=\"token punctuation\">(</span>__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">\\</span>       <span class=\"token punctuation\">)</span><span class=\"token punctuation\">\\</span>/<span class=\"token punctuation\">\\</span>\n                <span class=\"token operator\">||</span>----w <span class=\"token operator\">|</span>\n                <span class=\"token operator\">||</span>     <span class=\"token operator\">||</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"额外规则\"><a href=\"#额外规则\" class=\"headerlink\" title=\"额外规则\"></a>额外规则</h3><p><code>phpcs</code>自带的规则集比较少，这里推荐一组规则集<a href=\"https://github.com/slevomat/coding-standard\">slevomat/coding-standard</a>，最新版本使用了做了自动安装，使用体验非常丝滑。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token function\">composer</span> require slevomat/coding-standard --dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>如果你的项目中有使用ORM、数据库的字段有使用下划线、并且希望变量名强制使用小驼峰，那目前截至v3.5的<code>phpcs</code>自带规则<code>Squiz.NamingConventions.ValidVariableName.NotCamelCaps</code>将无法实现你的需求，会把<code>$user-&gt;created_at</code>误判为不规范，参照<a href=\"https://github.com/squizlabs/PHP_CodeSniffer/issues/1773\">Issue#1773</a></p>\n<p>等<code>phpcs</code>发布v4.0可能会修复，我写了个组件<a href=\"https://github.com/CloudyCity/coding-standard\">cloudycity/coding-standard</a>，可以暂时解决这个问题。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token function\">composer</span> require cloudycity/coding-standard --dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"最终的规则集\"><a href=\"#最终的规则集\" class=\"headerlink\" title=\"最终的规则集\"></a>最终的规则集</h4><details class=\"custom-details\">\n<summary>Click to see more</summary>\n<p><pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ruleset</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MyStandard<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- 新版本不需要手动安装第三方规则 --></span>\n    <span class=\"token comment\">&lt;!-- &lt;config name=\"installed_paths\" value=\"vendor/slevomat/coding-standard\"/> --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>description</span><span class=\"token punctuation\">></span></span>基于PSR2与slevomat的规则<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>description</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tab-width<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PSR2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- 不限制行的长度 --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Generic.Files.LineLength<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token comment\">&lt;!-- 跳过的目录 --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>bootstrap/cache/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>node_modules/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>public/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>resources/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>storage/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>vendor/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">&lt;!-- Laravel Migration &amp; Seeder 没有命名空间 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PSR1.Classes.ClassDeclaration<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>database/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclude-pattern</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">&lt;!-- 变量名采用驼峰 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>CloudyCityCodingStandard.NamingConventions.ValidVariableName.NotCamelCaps<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token comment\">&lt;!-- 字符串连接符前后空格 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Squiz.Strings.ConcatenationSpacing<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>spacing<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">&lt;!-- 确保函数前后空行，首个/最后函数除外 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Squiz.WhiteSpace.FunctionSpacing<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>spacing<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>spacingBeforeFirst<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>spacingAfterLast<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">&lt;!-- 操作符前后空格 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Squiz.WhiteSpace.OperatorSpacing<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ignoreNewlines<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ignoreSpacingBeforeAssignments<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">&lt;!-- 单行数组空格 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SlevomatCodingStandard.Arrays.SingleLineArrayWhitespace<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token comment\">&lt;!-- 多行数组元素强制以逗号结尾 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SlevomatCodingStandard.Arrays.TrailingArrayComma<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token comment\">&lt;!-- 禁止数组隐式创建 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SlevomatCodingStandard.Arrays.DisallowImplicitArrayCreation<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token comment\">&lt;!-- 禁止自动生成的注释 --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SlevomatCodingStandard.Commenting.ForbiddenComments<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span>\n                <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>forbiddenCommentPatterns<span class=\"token punctuation\">\"</span></span>\n                <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>array<span class=\"token punctuation\">\"</span></span>\n                <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>~^Created by \\S+\\.\\z~i,<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ruleset</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<h4 id=\"GitLab的兼容\"><a href=\"#GitLab的兼容\" class=\"headerlink\" title=\"GitLab的兼容\"></a>GitLab的兼容</h4><p>只要在gitlab的机器上也用composer引入<a href=\"https://github.com/slevomat/coding-standard\">slevomat/coding-standard</a>即可。</p>\n<p>在哪里引入都可以，这边选择和钩子同一个目录。<br><img src=\"https://user-images.githubusercontent.com/17662451/111274021-748fb900-866f-11eb-9bdf-8c9d3eefc801.png\" alt=\"image\"></p>\n<p>授予执行权限</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token function\">chmod</span> a+x vendor/squizlabs/php_codesniffer/bin/phpcs\n<span class=\"token function\">chmod</span> a+x vendor/squizlabs/php_codesniffer/bin/phpcbf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>修改<code>pre-receive</code>中的执行命令</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">output</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>/usr/local/bin/php7 /data/gitlab/repositories/php/demo.git/custom_hooks/vendor/squizlabs/php_codesniffer/bin/phpcs --standard<span class=\"token operator\">=</span>$standard --colors --encoding<span class=\"token operator\">=</span>utf-8 -n -p  $TMP_DIR/$file<span class=\"token variable\">)</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h3><p>上面提到的主要是针对单个仓库的强制规范检查策略，主要是我目前团队的各个项目的规范都有不同。<br>如果你的各项目都有相同的规范，可以将规范提取为一个组件，服务端也可以使用全局Hook，不必为每一个仓库加Hook。</p>\n<h3 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h3><p><a href=\"https://github.com/squizlabs/PHP_CodeSniffer\">PHP_CodeSniffer</a><br><a href=\"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks\">Git Hooks</a><br><a href=\"https://docs.gitlab.com/ee/administration/server_hooks.html#create-a-server-hook-for-a-repository\">GitLab Server Hooks</a><br><a href=\"https://github.com/smgladkovskiy/phpcs-git-pre-commit\">客户端Hook自动安装脚本</a><br><a href=\"https://bbs.csdn.net/topics/392558612?list=lz\">服务端Hook脚本</a></p>\n","feature":true,"text":"规范是团队中最重要的部分之一，多数团队是靠自觉+review维护规范，而强制检查是最有效的方案。本文就水一下介绍下PHP_CodeSniffer在项目中强制执行的最佳实践。 规范检查和表单检验一样，服务端是必须要检查的，客户端检查主要是优化使用体验。 客户端引入组件$ compo...","link":"","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%A2%E6%88%B7%E7%AB%AF\"><span class=\"toc-text\">客户端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%BC%95%E5%85%A5%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">引入组件</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83\"><span class=\"toc-text\">自定义规范</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">配置命令</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%89%8B%E5%8A%A8%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">手动执行</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">自动执行</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#PHPStorm%E5%8D%8F%E5%90%8C\"><span class=\"toc-text\">PHPStorm协同</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E7%AB%AF\"><span class=\"toc-text\">服务端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#GitLab\"><span class=\"toc-text\">GitLab</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%A2%9D%E5%A4%96%E8%A7%84%E5%88%99\"><span class=\"toc-text\">额外规则</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9C%80%E7%BB%88%E7%9A%84%E8%A7%84%E5%88%99%E9%9B%86\"><span class=\"toc-text\">最终的规则集</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#GitLab%E7%9A%84%E5%85%BC%E5%AE%B9\"><span class=\"toc-text\">GitLab的兼容</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%80%E5%90%8E\"><span class=\"toc-text\">最后</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#References\"><span class=\"toc-text\">References</span></a></li></ol>","author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}},"mapped":true,"prev_post":{"title":"Laravel-Websockets组件实践","uid":"fec643b4103ddf5fb791d3e0f56f5c2e","slug":"Laravel-Websockets组件实践","date":"2021-04-30T10:11:34.000Z","updated":"2021-06-04T10:30:25.045Z","comments":true,"path":"api/articles/Laravel-Websockets组件实践.json","cover":"https://laravelnews.imgix.net/images/laravel-websockets.png?ixlib=php-3.3.0","text":"给Laravel项目搭建Websocket服务时，不想用pusher这种在线服务? 觉得用laravel-echo-server监听事件不方便? 不想用swoole自己实现? 那你可以考虑Laravel官方推荐的laravel-websockets组件。 该组件有以下优点: 免费...","link":"","photos":[],"count_time":{"symbolsCount":"30k","symbolsTime":"27 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[{"name":"laravel","slug":"laravel","count":9,"path":"api/tags/laravel.json"},{"name":"websocket","slug":"websocket","count":1,"path":"api/tags/websocket.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}},"feature":true},"next_post":{"title":"Laravel优雅地支持多SMS","uid":"54163d6395a4d14b28c019a0ae6d39e3","slug":"Laravel优雅地支持多SMS","date":"2021-01-29T10:23:49.000Z","updated":"2021-06-04T10:30:25.044Z","comments":true,"path":"api/articles/Laravel优雅地支持多SMS.json","cover":"https://miro.medium.com/max/1200/1*TqJCpGhLCZixYW6Y8xMVbg.jpeg","text":"小公司可能为了节省短信成本，会选择多家短信服务商，但短信本身的模板不会太多。本文介绍下Laravel下如何优雅地实现这种场景。 依赖Laravel社区一个很赞的枚举组件 composer require bensampo/laravel-enum 这里以腾讯短信为例 compos...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[{"name":"laravel","slug":"laravel","count":9,"path":"api/tags/laravel.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}}}}