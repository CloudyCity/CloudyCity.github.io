{"title":"Laravel8 实现消息通知","uid":"54aa2f264be2b519410761b4dc6c84bf","slug":"Laravel8-实现消息通知","date":"2020-11-04T03:29:16.000Z","updated":"2021-06-04T10:30:25.045Z","comments":true,"path":"api/articles/Laravel8-实现消息通知.json","cover":"https://res.cloudinary.com/practicaldev/image/fetch/s--z9joCtos--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://thepracticaldev.s3.amazonaws.com/i/km70pecom0524qttto7z.jpeg","content":"<p>Laravel从5.3起，提供了<strong>广播</strong>、<strong>通知</strong>两个模块，可以很方便的实现消息通知。这里以<strong>评论回复通知</strong>为例进行介绍。</p>\n<span id=\"more\"></span>\n\n<p>简单介绍下概念</p>\n<ul>\n<li>广播的对象是Socket客户端，通知的对象是根据渠道而定。可选的通知渠道有广播、短信、邮件、数据库或自定义渠道。</li>\n<li>广播可以直接由事件触发或由通知触发，这里采用的是后者。</li>\n</ul>\n<h3 id=\"流程\"><a href=\"#流程\" class=\"headerlink\" title=\"流程\"></a>流程</h3><p><img src=\"https://user-images.githubusercontent.com/17662451/98322805-447e3c80-2023-11eb-9f98-997594111ba6.png\" alt=\"image\"></p>\n<h3 id=\"Laravel部分\"><a href=\"#Laravel部分\" class=\"headerlink\" title=\"Laravel部分\"></a>Laravel部分</h3><h4 id=\"用户\"><a href=\"#用户\" class=\"headerlink\" title=\"用户\"></a>用户</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Sys</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Model</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Notifications<span class=\"token punctuation\">\\</span>Notifiable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Model</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">use</span> <span class=\"token package\">Notifiable</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$table</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'user'</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">/**\n     * 用户接收广播通知的通道.\n     *\n     * @return mixed\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">receivesBroadcastNotificationsOn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'user.'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">id</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"评论\"><a href=\"#评论\" class=\"headerlink\" title=\"评论\"></a>评论</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Common</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Model</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Sys<span class=\"token punctuation\">\\</span>User</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Database<span class=\"token punctuation\">\\</span>Eloquent<span class=\"token punctuation\">\\</span>Relations<span class=\"token punctuation\">\\</span>BelongsTo</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Database<span class=\"token punctuation\">\\</span>Eloquent<span class=\"token punctuation\">\\</span>Relations<span class=\"token punctuation\">\\</span>MorphTo</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Comment</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Model</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$table</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'comment'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$fillable</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string single-quoted-string\">'content'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'uid'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'commentable_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'commentable_type'</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$with</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string single-quoted-string\">'user'</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token class-name return-type\">BelongsTo</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">belongsTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">User</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'uid'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">commentable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token class-name return-type\">MorphTo</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">morphTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"观察者\"><a href=\"#观察者\" class=\"headerlink\" title=\"观察者\"></a>观察者</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Observers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Common<span class=\"token punctuation\">\\</span>Comment</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Notifications<span class=\"token punctuation\">\\</span>CommentCreated</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CommentObserver</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Observer</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * Handle the User \"created\" event.\n     *\n     * @param Comment $comment\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">created</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Comment</span> <span class=\"token variable\">$comment</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">event</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">CommentCreated</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$comment</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"注册观察者\"><a href=\"#注册观察者\" class=\"headerlink\" title=\"注册观察者\"></a>注册观察者</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Providers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Common<span class=\"token punctuation\">\\</span>Comment</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Observers<span class=\"token punctuation\">\\</span>CommentObserver</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>ServiceProvider</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AppServiceProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceProvider</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * Register any application services.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">//</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * Bootstrap any application services.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token class-name static-context\">Comment</span><span class=\"token operator\">::</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">CommentObserver</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"事件\"><a href=\"#事件\" class=\"headerlink\" title=\"事件\"></a>事件</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Events</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Common<span class=\"token punctuation\">\\</span>Comment</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Foundation<span class=\"token punctuation\">\\</span>Events<span class=\"token punctuation\">\\</span>Dispatchable</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Queue<span class=\"token punctuation\">\\</span>SerializesModels</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CommentCreated</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">use</span> <span class=\"token package\">Dispatchable</span><span class=\"token punctuation\">,</span> SerializesModels<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @var Comment\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$comment</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * Create a new event instance.\n     *\n     * @param $comment\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$comment</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$comment</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"监听器\"><a href=\"#监听器\" class=\"headerlink\" title=\"监听器\"></a>监听器</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Listeners</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Events<span class=\"token punctuation\">\\</span>CommentCreated</span> <span class=\"token keyword\">as</span> CommentCreatedEvent<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Gs<span class=\"token punctuation\">\\</span>IssueLog</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Sys<span class=\"token punctuation\">\\</span>User</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Notifications<span class=\"token punctuation\">\\</span>CommentCreated</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">NotifyComment</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Listener</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * Handle the notification.\n     *\n     * @param CommentCreatedEvent $event\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">CommentCreatedEvent</span> <span class=\"token variable\">$event</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// 相关用户</span>\n        <span class=\"token variable\">$users</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$event</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">commentable</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">IssueLog</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// 工单跟进者</span>\n            <span class=\"token variable\">$user</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$event</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">commentable</span><span class=\"token operator\">-></span><span class=\"token property\">user</span><span class=\"token operator\">-></span><span class=\"token property\">id</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$event</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">commentable</span><span class=\"token operator\">-></span><span class=\"token property\">user</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// 工单创建者</span>\n            <span class=\"token variable\">$user</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$event</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">commentable</span><span class=\"token operator\">-></span><span class=\"token property\">creator</span><span class=\"token operator\">-></span><span class=\"token property\">id</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$event</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">commentable</span><span class=\"token operator\">-></span><span class=\"token property\">creator</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// 工单报表评论者</span>\n            <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$event</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">commentable</span><span class=\"token operator\">-></span><span class=\"token property\">comments</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$cmt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token variable\">$users</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$cmt</span><span class=\"token operator\">-></span><span class=\"token property\">user</span><span class=\"token operator\">-></span><span class=\"token property\">id</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$users</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$cmt</span><span class=\"token operator\">-></span><span class=\"token property\">user</span><span class=\"token operator\">-></span><span class=\"token property\">id</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">??</span> <span class=\"token variable\">$cmt</span><span class=\"token operator\">-></span><span class=\"token property\">user</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token comment\">// 发送通知</span>\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$users</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">/** @var User $user */</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token property\">id</span> <span class=\"token operator\">!=</span> <span class=\"token variable\">$event</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">uid</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">CommentCreated</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$event</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">提示</p>\n<p>Laravel从5.8.9开始支持事件发现，无需手动注册事件及对应监听器。</p>\n</div>\n<h4 id=\"通知\"><a href=\"#通知\" class=\"headerlink\" title=\"通知\"></a>通知</h4><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Notifications</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Bus<span class=\"token punctuation\">\\</span>Queueable</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Queue<span class=\"token punctuation\">\\</span>ShouldQueue</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Common<span class=\"token punctuation\">\\</span>Comment</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\"><span class=\"token punctuation\">\\</span>Illuminate<span class=\"token punctuation\">\\</span>Notifications<span class=\"token punctuation\">\\</span>Notification</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CommentCreated</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseNotification</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ShouldQueue</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">use</span> <span class=\"token package\">Queueable</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$comment</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * Get the notification's delivery channels.\n     *\n     * @return array\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">via</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'broadcast'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'database'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * Create a new notification instance.\n     *\n     * @param Comment $comment\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Comment</span> <span class=\"token variable\">$comment</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$comment</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * Get the array representation of the notification.\n     *\n     * @return array\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'commentable'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">commentable</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'commentable_type'</span> <span class=\"token operator\">=></span> <span class=\"token function\">get_class</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span><span class=\"token operator\">-></span><span class=\"token property\">commentable</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'comment'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">comment</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"NodeJS部分\"><a href=\"#NodeJS部分\" class=\"headerlink\" title=\"NodeJS部分\"></a>NodeJS部分</h3><h4 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">npm i laravel-echo laravel-echo-server pm2 socket.io-client<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"启动Larvel-Echo-Server\"><a href=\"#启动Larvel-Echo-Server\" class=\"headerlink\" title=\"启动Larvel Echo Server\"></a>启动Larvel Echo Server</h4><h5 id=\"启动脚本\"><a href=\"#启动脚本\" class=\"headerlink\" title=\"启动脚本\"></a>启动脚本</h5><p>queue-listen.sh</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n\nphp artisan queue:listen --tries<span class=\"token operator\">=</span><span class=\"token number\">1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>socket.sh</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n\nnode_modules/laravel-echo-server/bin/server.js  start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"使用PM2调度\"><a href=\"#使用PM2调度\" class=\"headerlink\" title=\"使用PM2调度\"></a>使用PM2调度</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">node_modules&#x2F;pm2&#x2F;bin&#x2F;pm2 start queue-listen.sh\nnode_modules&#x2F;pm2&#x2F;bin&#x2F;pm2 start socket.sh\nnode_modules&#x2F;pm2&#x2F;bin&#x2F;pm2 monit # 监控进程输出，便于开发调试\n# 后续调度可使用stop&#x2F;start&#x2F;restart all<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">提示</p>\n<p>你可以使用Supervisor代替PM2。</p>\n</div>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">注意</p>\n<p>PM2启动的进程与用户关联，使用同一个户进行操作，避免重复启动</p>\n</div>\n<h4 id=\"Laravel-Echo监听通知\"><a href=\"#Laravel-Echo监听通知\" class=\"headerlink\" title=\"Laravel Echo监听通知\"></a>Laravel Echo监听通知</h4><h5 id=\"全局变量声明\"><a href=\"#全局变量声明\" class=\"headerlink\" title=\"全局变量声明\"></a>全局变量声明</h5><p>resources/js/bootstrap.js</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">\n<span class=\"token comment\">/**\n * Echo exposes an expressive API for subscribing to channels and listening\n * for events that are broadcast by Laravel. Echo and event broadcasting\n * allows your team to easily build robust real-time web applications.\n */</span>\n\n<span class=\"token keyword\">import</span> Echo <span class=\"token keyword\">from</span> <span class=\"token string\">'laravel-echo'</span><span class=\"token punctuation\">;</span>\n\nwindow<span class=\"token punctuation\">.</span>io <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'socket.io-client'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nwindow<span class=\"token punctuation\">.</span>Echo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Echo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n    broadcaster<span class=\"token operator\">:</span> <span class=\"token string\">'socket.io'</span><span class=\"token punctuation\">,</span>\n    host<span class=\"token operator\">:</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">MIX_APP_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'local'</span> <span class=\"token operator\">?</span> <span class=\"token string\">':6001'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    auth<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n        headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"启动监听\"><a href=\"#启动监听\" class=\"headerlink\" title=\"启动监听\"></a>启动监听</h4><p>主视图</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n    Echo<span class=\"token punctuation\">.</span><span class=\"token function\">private</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user.'</span> <span class=\"token operator\">+</span> uid<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">notification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// do something</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","text":"Laravel从5.3起，提供了广播、通知两个模块，可以很方便的实现消息通知。这里以评论回复通知为例进行介绍。 简单介绍下概念 广播的对象是Socket客户端，通知的对象是根据渠道而定。可选的通知渠道有广播、短信、邮件、数据库或自定义渠道。 广播可以直接由事件触发或由通知触发，这...","link":"","photos":[],"count_time":{"symbolsCount":"6.1k","symbolsTime":"6 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[{"name":"laravel","slug":"laravel","count":9,"path":"api/tags/laravel.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">流程</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Laravel%E9%83%A8%E5%88%86\"><span class=\"toc-text\">Laravel部分</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7\"><span class=\"toc-text\">用户</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%AF%84%E8%AE%BA\"><span class=\"toc-text\">评论</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%A7%82%E5%AF%9F%E8%80%85\"><span class=\"toc-text\">观察者</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E5%86%8C%E8%A7%82%E5%AF%9F%E8%80%85\"><span class=\"toc-text\">注册观察者</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">事件</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%9B%91%E5%90%AC%E5%99%A8\"><span class=\"toc-text\">监听器</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%80%9A%E7%9F%A5\"><span class=\"toc-text\">通知</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#NodeJS%E9%83%A8%E5%88%86\"><span class=\"toc-text\">NodeJS部分</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">安装依赖</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8Larvel-Echo-Server\"><span class=\"toc-text\">启动Larvel Echo Server</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">启动脚本</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8PM2%E8%B0%83%E5%BA%A6\"><span class=\"toc-text\">使用PM2调度</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Laravel-Echo%E7%9B%91%E5%90%AC%E9%80%9A%E7%9F%A5\"><span class=\"toc-text\">Laravel Echo监听通知</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E\"><span class=\"toc-text\">全局变量声明</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E7%9B%91%E5%90%AC\"><span class=\"toc-text\">启动监听</span></a></li></ol></li></ol>","author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}},"mapped":true,"prev_post":{"title":"ElementUI Tree组件实现完美的联动选择","uid":"cac2d032fc8fac9e1fbce97e3094eaa7","slug":"ElementUI-Tree组件实现完美的联动选择","date":"2021-01-07T06:24:56.000Z","updated":"2021-06-04T10:30:25.044Z","comments":true,"path":"api/articles/ElementUI-Tree组件实现完美的联动选择.json","cover":"https://pic4.zhimg.com/v2-a1e6c95e17fe8619c25bf3dbfebfb012_1440w.jpg?source=172ae18b","text":"Element Tree组件默认支持【联动选择】，但是无法【只选中父项，不选任何子项】，这里介绍如何实现完美的联动选择。 关闭自带的【联动选择 】特性ElTree的check-strictly属性默认为false，至少一个子项被勾选时，父项会进入半选中/选中状态。 改为true即...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"前端","slug":"前端","count":4,"path":"api/categories/前端.json"}],"tags":[{"name":"vue","slug":"vue","count":1,"path":"api/tags/vue.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}}},"next_post":{"title":"使用Laravel-Mix构建Asset","uid":"771f319b1167e8a6f517a3bd10fbf0af","slug":"使用Laravel-Mix构建Asset","date":"2020-11-03T10:31:58.000Z","updated":"2021-06-04T10:30:25.046Z","comments":true,"path":"api/articles/使用Laravel-Mix构建Asset.json","cover":"https://repository-images.githubusercontent.com/76991633/43a4fe80-025e-11eb-8b88-bf742e4412a7","text":"公司几个后台老项目的asset都没有构建方案，直接放到版本控制仓库里，臃肿凌乱，加载速度也堪忧。最近开发一个新后台，决定改用laravel-mix构建asset。 改造前的文件结构(Git) Click to see more ├── public │ ├── asset │ │...","link":"","photos":[],"count_time":{"symbolsCount":"24k","symbolsTime":"22 mins."},"categories":[{"name":"前端","slug":"前端","count":4,"path":"api/categories/前端.json"}],"tags":[{"name":"webpack","slug":"webpack","count":2,"path":"api/tags/webpack.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity/home/"}}}}}}