{"title":"Laravel优雅地支持多SMS","uid":"54163d6395a4d14b28c019a0ae6d39e3","slug":"Laravel优雅地支持多SMS","date":"2021-01-29T10:23:49.000Z","updated":"2021-06-17T09:25:06.579Z","comments":true,"path":"api/articles/Laravel优雅地支持多SMS.json","cover":"https://miro.medium.com/max/1200/1*TqJCpGhLCZixYW6Y8xMVbg.jpeg","content":"<p>小公司可能为了节省短信成本，会选择多家短信服务商，但短信本身的模板不会太多。本文介绍下<code>Laravel</code>下如何优雅地实现这种场景。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h3><p>Laravel社区一个很赞的枚举组件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">composer <span class=\"token keyword\">require</span> bensampo<span class=\"token operator\">/</span>laravel<span class=\"token operator\">-</span>enum<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>这里以腾讯短信为例</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">composer <span class=\"token keyword\">require</span> tencentcloud<span class=\"token operator\">/</span>tencentcloud<span class=\"token operator\">-</span>sdk<span class=\"token operator\">-</span>php<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"接口\"><a href=\"#接口\" class=\"headerlink\" title=\"接口\"></a>接口</h3><p>现在多数短信服务端都是采用模板，发送更快，所以这里接口直接按这种模式设计。<br>如果需要接入未使用模版的服务商，可以自行实现模板（用<code>sprintf()</code>替换字符串），相当于做了使用模板的服务商所做的工作。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Contracts</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Sms</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * 发送短信\n     *\n     * @param $phone\n     * @param $templateId\n     * @param $templateParams\n     * @return bool\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateId</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateParams</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * 批量发送短信\n     *\n     * @param array $phones\n     * @param $templateId\n     * @param $templateParams\n     * @return bool\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">batchSend</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phones</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateId</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateParams</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * 返回余额\n     *\n     * @return float\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * 获取模版\n     *\n     * @param string $for 模板用途\n     * @return int\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getTemplateId</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$for</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"枚举\"><a href=\"#枚举\" class=\"headerlink\" title=\"枚举\"></a>枚举</h3><p>每当要接入一个服务商，首先增加一个枚举，后面在服务，模型，界面选项都使用该枚举。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Enums</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">BenSampo<span class=\"token punctuation\">\\</span>Enum<span class=\"token punctuation\">\\</span>Enum</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * 短信服务商\n *\n * @method static static TENCENT()\n */</span>\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SmsProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Enum</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">TENCENT</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'tencent'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getDescription</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">string</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span> <span class=\"token operator\">===</span> <span class=\"token keyword static-context\">self</span><span class=\"token operator\">::</span><span class=\"token constant\">TENCENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'腾讯'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">parent</span><span class=\"token operator\">::</span><span class=\"token function\">getDescription</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h3><p><code>config/sms.php</code></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// 默认服务商</span>\n    <span class=\"token string single-quoted-string\">'default_provider'</span> <span class=\"token operator\">=></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'SMS_DEFAULT_PROVIDER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 各服务商配置</span>\n    <span class=\"token string single-quoted-string\">'tencent'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string single-quoted-string\">'app_id'</span> <span class=\"token operator\">=></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'SMS_TENCENT_APP_ID'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'secret_id'</span> <span class=\"token operator\">=></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'SMS_TENCENT_SECRET_ID'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'secret_key'</span> <span class=\"token operator\">=></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'SMS_TENCENT_SECRET_KEY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'template_ids'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'captcha'</span> <span class=\"token operator\">=></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'SMS_TENCENT_TEMPLATE_IDS_CAPTCHA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"服务实现\"><a href=\"#服务实现\" class=\"headerlink\" title=\"服务实现\"></a>服务实现</h3><p>创建基类，构造时从配置中初始化模板参数。</p>\n<details class=\"custom-details\">\n<summary>Click to see more</summary>\n<p><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Sms</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseSms</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Sms</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * 服务商名称\n     *\n     * @var string\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * 短信模板ID映射\n     *\n     * @var array\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$templateIds</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * 短信模板用途集合\n     *\n     * @var array\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$templateUses</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'captcha'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * BaseSms constructor.\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">templateUses</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$templateUse</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">templateIds</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$templateUse</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"system.sms.<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">name</span><span class=\"token punctuation\">&#125;</span></span>.template_ids.<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$templateUse</span><span class=\"token punctuation\">&#125;</span></span>&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 获取模版\n     *\n     * @param $for\n     * @return int|mixed|null\n     * @throws \\Exception\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getTemplateId</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$for</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">templateIds</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$for</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>Exception</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$for</span><span class=\"token punctuation\">&#125;</span></span>短信模板不存在\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">templateIds</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$for</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>每个服务类只需要在构造函数中做好参数初始化，并实现三个方法即可。</p>\n<details class=\"custom-details\">\n<summary>Click to see more</summary>\n<p><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Enums<span class=\"token punctuation\">\\</span>SmsProvider</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">TencentCloud<span class=\"token punctuation\">\\</span>Common<span class=\"token punctuation\">\\</span>Credential</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">TencentCloud<span class=\"token punctuation\">\\</span>Common<span class=\"token punctuation\">\\</span>Profile<span class=\"token punctuation\">\\</span>ClientProfile</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">TencentCloud<span class=\"token punctuation\">\\</span>Common<span class=\"token punctuation\">\\</span>Profile<span class=\"token punctuation\">\\</span>HttpProfile</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">TencentCloud<span class=\"token punctuation\">\\</span>Sms<span class=\"token punctuation\">\\</span>V20190711<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>SendSmsRequest</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">TencentCloud<span class=\"token punctuation\">\\</span>Sms<span class=\"token punctuation\">\\</span>V20190711<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>SmsPackagesStatisticsRequest</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">TencentCloud<span class=\"token punctuation\">\\</span>Sms<span class=\"token punctuation\">\\</span>V20190711<span class=\"token punctuation\">\\</span>SmsClient</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TencentSms</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseSms</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$appId</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$secretId</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$secretKey</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * TencentSMS constructor.\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">name</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">SmsProvider</span><span class=\"token operator\">::</span><span class=\"token constant\">TENCENT</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">appId</span> <span class=\"token operator\">=</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'system.sms.tencent.app_id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">secretId</span> <span class=\"token operator\">=</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'system.sms.tencent.secret_id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">secretKey</span> <span class=\"token operator\">=</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'system.sms.tencent.secret_key'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword static-context\">parent</span><span class=\"token operator\">::</span><span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 发送短信\n     *\n     * @param $phone\n     * @param $templateId\n     * @param $templateParams\n     * @return bool\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateId</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateParams</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">batchSend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateId</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateParams</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 批量发送短信\n     *\n     * @param array $phones\n     * @param $templateId\n     * @param $templateParams\n     * @return bool\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">batchSend</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phones</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateId</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateParams</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// 处理参数</span>\n        <span class=\"token variable\">$phones</span> <span class=\"token operator\">=</span> <span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phones</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$phones</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token variable\">$phones</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$phones</span> <span class=\"token operator\">=</span> <span class=\"token function\">array_map</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'addPhoneAreaCode'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$phones</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$templateParams</span> <span class=\"token operator\">=</span> <span class=\"token function\">array_map</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'strval'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateParams</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 实例化一个证书对象，入参需要传入腾讯云账户secretId，secretKey</span>\n        <span class=\"token variable\">$cred</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Credential</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">secretId</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">secretKey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$httpProfile</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpProfile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$httpProfile</span><span class=\"token operator\">-></span><span class=\"token function\">setEndpoint</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"sms.tencentcloudapi.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$clientProfile</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClientProfile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$clientProfile</span><span class=\"token operator\">-></span><span class=\"token function\">setHttpProfile</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$httpProfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 实例化要请求产品(以cvm为例)的client对象</span>\n        <span class=\"token variable\">$client</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SmsClient</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cred</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"ap-guangzhou\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 实例化一个请求对象</span>\n        <span class=\"token variable\">$req</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SendSmsRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$req</span><span class=\"token operator\">-></span><span class=\"token function\">fromJsonString</span><span class=\"token punctuation\">(</span><span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'PhoneNumberSet'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$phones</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'TemplateID'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$templateId</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'Sign'</span> <span class=\"token operator\">=></span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'system.sms.tencent.sign'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'TemplateParamSet'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$templateParams</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'SmsSdkAppid'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">appId</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 通过client对象调用想要访问的接口，需要传入请求对象</span>\n        <span class=\"token variable\">$res</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$client</span><span class=\"token operator\">-></span><span class=\"token function\">SendSms</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$req</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token operator\">-></span><span class=\"token property\">SendStatusSet</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$sendStatus</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">/** @var \\TencentCloud\\Sms\\V20190711\\Models\\SendStatus $sendStatus */</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$sendStatus</span><span class=\"token operator\">-></span><span class=\"token property\">Code</span> <span class=\"token operator\">!=</span> <span class=\"token string single-quoted-string\">'Ok'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 返回余额\n     *\n     * @return float\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$cred</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Credential</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">secretId</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">secretKey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$httpProfile</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpProfile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$httpProfile</span><span class=\"token operator\">-></span><span class=\"token function\">setEndpoint</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"sms.tencentcloudapi.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$clientProfile</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClientProfile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$clientProfile</span><span class=\"token operator\">-></span><span class=\"token function\">setHttpProfile</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$httpProfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$client</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SmsClient</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cred</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$clientProfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$req</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SmsPackagesStatisticsRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$params</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'Limit'</span> <span class=\"token operator\">=></span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'Offset'</span> <span class=\"token operator\">=></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'SmsSdkAppid'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">appId</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$params</span> <span class=\"token operator\">=</span> <span class=\"token function\">json_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$params</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$req</span><span class=\"token operator\">-></span><span class=\"token function\">fromJsonString</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$params</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$resp</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$client</span><span class=\"token operator\">-></span><span class=\"token function\">SmsPackagesStatistics</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$req</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$smsPackagesStatisticsSet</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$resp</span><span class=\"token operator\">-></span><span class=\"token property\">SmsPackagesStatisticsSet</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$maxSmsPackagesStatistics</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">getMaxSmsPackagesStatistics</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$smsPackagesStatisticsSet</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 当前套餐包剩余使用量</span>\n        <span class=\"token variable\">$remainingNumber</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$maxSmsPackagesStatistics</span><span class=\"token operator\">-></span><span class=\"token property\">AmountOfPackage</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$maxSmsPackagesStatistics</span><span class=\"token operator\">-></span><span class=\"token property\">CurrentUsage</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$balance</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$remainingNumber</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.05</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$balance</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 从集合中查找出剩余短信条数最大的套餐包\n     *\n     * @param $smsPackagesStatisticsSet\n     * @return mixed | object\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getMaxSmsPackagesStatistics</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$smsPackagesStatisticsSet</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$smsPackagesStatisticsSet</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$smsPackagesStatisticsSet</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token variable\">$smsPackagesStatisticsSet</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token variable\">$maxRemainingNumber</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 最大套餐包剩余使用量</span>\n        <span class=\"token variable\">$maxSmsPackagesStatistics</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 剩余短信条数最大的套餐包</span>\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$smsPackagesStatisticsSet</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$smsPackagesStatistics</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// 当前套餐包剩余使用量</span>\n            <span class=\"token variable\">$remainingNumber</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$smsPackagesStatistics</span><span class=\"token operator\">-></span><span class=\"token property\">AmountOfPackage</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$smsPackagesStatistics</span><span class=\"token operator\">-></span><span class=\"token property\">CurrentUsage</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$remainingNumber</span> <span class=\"token operator\">>=</span> <span class=\"token variable\">$maxRemainingNumber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token variable\">$maxRemainingNumber</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$remainingNumber</span><span class=\"token punctuation\">;</span>\n                <span class=\"token variable\">$maxSmsPackagesStatistics</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$smsPackagesStatistics</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$maxSmsPackagesStatistics</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<h3 id=\"服务提供者与发送类\"><a href=\"#服务提供者与发送类\" class=\"headerlink\" title=\"服务提供者与发送类\"></a>服务提供者与发送类</h3><p>分为两类场景：调用方始终使用同一个服务商、调用方可能使用不同服务商。</p>\n<h4 id=\"调用方始终使用同一个服务商\"><a href=\"#调用方始终使用同一个服务商\" class=\"headerlink\" title=\"调用方始终使用同一个服务商\"></a>调用方始终使用同一个服务商</h4><h5 id=\"服务提供者\"><a href=\"#服务提供者\" class=\"headerlink\" title=\"服务提供者\"></a>服务提供者</h5><p>扩展绑定<code>Sms</code>接口到实现上，并绑定<code>Sender</code>的单例。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Providers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Sms</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms<span class=\"token punctuation\">\\</span>TencentSms</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>ServiceProvider</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SmsServiceProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceProvider</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * Register any application services.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">//</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * Bootstrap any application services.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">app</span><span class=\"token operator\">-></span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">Sms</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$service</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token variable\">$smsProvider</span> <span class=\"token operator\">=</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'system.sms.provider'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$smsProvider</span> <span class=\"token operator\">===</span> <span class=\"token class-name static-context\">SmsProvider</span><span class=\"token operator\">::</span><span class=\"token constant\">TENCENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TencentSMS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TencentSms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">app</span><span class=\"token operator\">-></span><span class=\"token function\">singleton</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">Sender</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$app</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Sender</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$app</span><span class=\"token operator\">-></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">Sms</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"发送类\"><a href=\"#发送类\" class=\"headerlink\" title=\"发送类\"></a>发送类</h5><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Enums<span class=\"token punctuation\">\\</span>SmsProvider</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Redis</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Sender</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * @var TencentSms\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$sms</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Sms</span> <span class=\"token variable\">$smsProvider</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">smsProvider</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$smsProvider</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 发送验证码\n     *\n     * @template 验证码 &#123;1&#125;，15分钟内有效，请勿向任何人泄露。\n     * @param int|string $phone\n     * @param int $length 验证码长度, 范围4-6\n     * @param int $ttl 有效时间(分钟)\n     * @return bool\n     * @throws \\Exception\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">sendCaptcha</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$length</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ttl</span> <span class=\"token operator\">=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$captcha</span> <span class=\"token operator\">=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token function\">mt_rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">100000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">999999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$length</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$templateId</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">sms</span><span class=\"token operator\">-></span><span class=\"token function\">getTemplateId</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'captcha'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name static-context\">Redis</span><span class=\"token operator\">::</span><span class=\"token function\">setex</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"captcha:<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">&#125;</span></span>\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ttl</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$captcha</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">sms</span><span class=\"token operator\">-></span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateId</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token variable\">$captcha</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"调用示例\"><a href=\"#调用示例\" class=\"headerlink\" title=\"调用示例\"></a>调用示例</h5><p>自动注入获取单例</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms<span class=\"token punctuation\">\\</span>Sender</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">,</span> <span class=\"token class-name type-declaration\">Sender</span> <span class=\"token variable\">$sender</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">// do some work and send a message</span>\n    <span class=\"token variable\">$sender</span><span class=\"token operator\">-></span><span class=\"token function\">sendCaptcha</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>直接解析获取单例</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms<span class=\"token punctuation\">\\</span>Sender</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$sender</span> <span class=\"token operator\">=</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">Sender</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$sender</span><span class=\"token operator\">-></span><span class=\"token function\">sendCaptcha</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"调用方可能使用不同服务商\"><a href=\"#调用方可能使用不同服务商\" class=\"headerlink\" title=\"调用方可能使用不同服务商\"></a>调用方可能使用不同服务商</h4><h5 id=\"服务提供者-1\"><a href=\"#服务提供者-1\" class=\"headerlink\" title=\"服务提供者\"></a>服务提供者</h5><p>每个服务使用单例，采用延迟加载。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Providers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms<span class=\"token punctuation\">\\</span>TencentSms</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>DeferrableProvider</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>ServiceProvider</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SmsServiceProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceProvider</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">DeferrableProvider</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * Register any application services.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">app</span><span class=\"token operator\">-></span><span class=\"token function\">singleton</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">TencentSms</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TencentSms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * Bootstrap any application services.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">//</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * Get the services provided by the provider.\n     *\n     * @return array\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">provides</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token class-name static-context\">TencentSms</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"发送类-1\"><a href=\"#发送类-1\" class=\"headerlink\" title=\"发送类\"></a>发送类</h5><p>调用方传入服务商的枚举值。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Enums<span class=\"token punctuation\">\\</span>SmsProvider</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Redis</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Sender</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/**\n     * @var TencentSms\n     */</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$sms</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$smsProvider</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$smsProvider</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$smsProvider</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'system.sms.default_provider'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$smsProvider</span> <span class=\"token operator\">===</span> <span class=\"token class-name static-context\">SmsProvider</span><span class=\"token operator\">::</span><span class=\"token constant\">TENCENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">sms</span> <span class=\"token operator\">=</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">TencentSms</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 获取单例</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 发送验证码\n     *\n     * @template 验证码 &#123;1&#125;，15分钟内有效，请勿向任何人泄露。\n     * @param int|string $phone\n     * @param int $length 验证码长度, 范围4-6\n     * @param int $ttl 有效时间(分钟)\n     * @return bool\n     * @throws \\Exception\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">sendCaptcha</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$length</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ttl</span> <span class=\"token operator\">=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token variable\">$captcha</span> <span class=\"token operator\">=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token function\">mt_rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">100000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">999999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$length</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$templateId</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">sms</span><span class=\"token operator\">-></span><span class=\"token function\">getTemplateId</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'captcha'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name static-context\">Redis</span><span class=\"token operator\">::</span><span class=\"token function\">setex</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"captcha:<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">&#125;</span></span>\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ttl</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$captcha</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">sms</span><span class=\"token operator\">-></span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$templateId</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token variable\">$captcha</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"调用示例-1\"><a href=\"#调用示例-1\" class=\"headerlink\" title=\"调用示例\"></a>调用示例</h5><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Enums<span class=\"token punctuation\">\\</span>SmsProvider</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Services<span class=\"token punctuation\">\\</span>Sms<span class=\"token punctuation\">\\</span>Sender</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$sender</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Sender</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">SmsProvider</span><span class=\"token operator\">::</span><span class=\"token constant\">TENCENT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$sender</span><span class=\"token operator\">-></span><span class=\"token function\">sendCaptcha</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>","text":"小公司可能为了节省短信成本，会选择多家短信服务商，但短信本身的模板不会太多。本文介绍下Laravel下如何优雅地实现这种场景。 依赖Laravel社区一个很赞的枚举组件 composer require bensampo/laravel-enum 这里以腾讯短信为例 compos...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[{"name":"laravel","slug":"laravel","count":9,"path":"api/tags/laravel.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">依赖</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8E%A5%E5%8F%A3\"><span class=\"toc-text\">接口</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9E%9A%E4%B8%BE\"><span class=\"toc-text\">枚举</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">配置文件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">服务实现</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85%E4%B8%8E%E5%8F%91%E9%80%81%E7%B1%BB\"><span class=\"toc-text\">服务提供者与发送类</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E6%96%B9%E5%A7%8B%E7%BB%88%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%95%86\"><span class=\"toc-text\">调用方始终使用同一个服务商</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85\"><span class=\"toc-text\">服务提供者</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%91%E9%80%81%E7%B1%BB\"><span class=\"toc-text\">发送类</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">调用示例</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E6%96%B9%E5%8F%AF%E8%83%BD%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E6%9C%8D%E5%8A%A1%E5%95%86\"><span class=\"toc-text\">调用方可能使用不同服务商</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85-1\"><span class=\"toc-text\">服务提供者</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%91%E9%80%81%E7%B1%BB-1\"><span class=\"toc-text\">发送类</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B-1\"><span class=\"toc-text\">调用示例</span></a></li></ol></li></ol></li></ol>","author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity"}}}},"mapped":true,"prev_post":{"title":"PHP强制规范检查的最佳实践","uid":"7383adf578f96139725a89cef1cef06f","slug":"PHP强制规范检查的最佳实践","date":"2021-01-29T08:25:35.000Z","updated":"2021-06-17T09:25:06.579Z","comments":true,"path":"api/articles/PHP强制规范检查的最佳实践.json","cover":"https://d1xmlzncnovrpo.cloudfront.net/sites/default/files/public/blog-image/PHP_CodeSniffer-Ignoring-Standards.jpg","text":"规范是团队中最重要的部分之一，多数团队是靠自觉+review维护规范，而强制检查是最有效的方案。本文就水一下介绍下PHP_CodeSniffer在项目中强制执行的最佳实践。 规范检查和表单检验一样，服务端是必须要检查的，客户端检查主要是优化使用体验。 客户端引入组件$ compo...","link":"","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity"}}}},"feature":true},"next_post":{"title":"PHP项目在MySQL使用顺序的UUID","uid":"c745740a7cf2e407606f48886b844e67","slug":"PHP项目在MySQL使用顺序的UUID","date":"2021-01-20T09:38:35.000Z","updated":"2021-06-17T09:25:06.579Z","comments":true,"path":"api/articles/PHP项目在MySQL使用顺序的UUID.json","cover":"https://files.speakerdeck.com/presentations/ac4260cccd9b41418e61426acf0f9e73/slide_22.jpg","text":"分布式系统的数据库都离不开UUID。在RFC 4122标准中各版本的UUID都有存在一些缺点，简单概括就是长而乱序。其中乱序则是通过顺序的UUID来减少影响。 本文介绍什么是顺序的UUID，以及如何在PHP中生成。 标准UUID的缺点长度为36位太长基本是无解的。虽然转换成字节型...","link":"","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[{"name":"php","slug":"php","count":12,"path":"api/categories/php.json"}],"tags":[{"name":"mysql","slug":"mysql","count":2,"path":"api/tags/mysql.json"}],"author":{"name":"CloudyCity","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17662451?s=400&u=643d94296b79c5e8424a2177fc4609a5e0ebeae0&v=4","link":"/","description":"拖延并发强迫症懒癌晚期患者","socials":{"github":"https://github.com/CloudyCity","twitter":"","stackoverflow":"https://stackoverflow.com/users/9827779/cloudycity","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://b23.tv/MK4nKb"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/cloudycity"}}}}}}